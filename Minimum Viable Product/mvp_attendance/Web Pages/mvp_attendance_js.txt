    // Hide the default footer & header from the web page
    
    $(document).ready(() => {  
        
        //console.log(document.getElementsByTagName("nav")[0].innerHTML);
          
        // Hiding the default navbar part
            
        // var e=document.getElementsByTagName("nav")[0];
        // e.parentNode.removeChild(e);
        
        // Hiding the default footer part
        
        var f=document.getElementsByClassName("web-footer")[0];
        f.parentNode.removeChild(f);
    });
    
    // Selection of Month for Attendance Summary Report
    
    function fillSelectMonth(){
        
        var el=$("#monthlyattendance");
        var n=12;
        var m =['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'];
        var last_n_months =[];
        var d = moment();
        // console.log(d);
        for(var i=0; i<n; i++){
            
            // last_n_months[i] = m[d.getMonth()]+ ' ' + d.getFullYear().toString();
            last_n_months[i] = m[d.month()]+ ' ' + d.year().toString();
            var txt=last_n_months[i];// console.log(txt);
            // var date=d.getFullYear().toString()+"-"+(d.getMonth()+1)+"-01";
            var date=d.year().toString()+"-"+(d.month()+1)+"-01";
            // console.log(date);
            //var opt=document.createElement("option");opt.innerHTML=last_n_months[i];
            //console.log(opt);
            el.append(`<option value='${date}'>${txt}</option>`);
            // console.log(d.getMonth());console.log(d);
            d.month(d.month()-1);
            //console.log(d.getMonth());console.log(d);
            
      } // for loop ends here
     
    } // function ends here

    // Selection of Month for Daily Production Report

    function fillSelectMonth_one(){
        
        var el=$("#monthlyattendance_one");
        var n=12;
        var m =['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'];
        var last_n_months =[];
        var d = moment();
        for(var i=0; i<n; i++){
            
            // last_n_months[i] = m[d.getMonth()]+ ' ' + d.getFullYear().toString();
            last_n_months[i] = m[d.month()]+ ' ' + d.year().toString();
            var txt=last_n_months[i];// console.log(txt);
            // var date=d.getFullYear().toString()+"-"+(d.getMonth()+1)+"-01";
            var date=d.year().toString()+"-"+(d.month()+1)+"-01";
            // console.log(date);
            //var opt=document.createElement("option");opt.innerHTML=last_n_months[i];
            //console.log(opt);
            el.append(`<option value='${date}'>${txt}</option>`);
            // console.log(d.getMonth());console.log(d);
            d.month(d.month()-1);
            //console.log(d.getMonth());console.log(d);
            
        } // for loop ends here
     
    } // function ends here

    // Display of monthly attendance data

    function showMonthlyAttendance(val){
        
        // var dateRangeFrom = document.getElementById('fromdate');
        // dateRangeFrom.disabled = true;
        
        // var dateRangeTo = document.getElementById('todate');
        // dateRangeTo.disabled = true;
        
        // var show = document.getElementById('show');
        // show.style.display = 'none';
        
        // var selectBoxx = document.getElementById('searchEmployee');
        // selectBoxx.innerHTML=" ";
    
       // document.getElementById("selectBox").style.display="none";  // Hide the downloading feature from the data table on month selection
        document.getElementById("attendance_history_table_wrapper").style.display="none";
        document.getElementById("monthlyattendancediv").style.display="block";
        document.getElementById("abbr").style.display="flex";
        document.getElementById("abbr_one").style.display="flex";
        
        var mtable=document.getElementById("monthly_attendance_table");
        mtable.innerHTML=" ";
        var thead=document.createElement("thead");
        var date=moment(val,"YYYY-MM-DD");
        var totdays=date.daysInMonth();
        var etr1=document.createElement("tr");
        var etr2=document.createElement("tr"); 
        
        var th=document.createElement("th");
        // th.rowSpan = '2';
        th.setAttribute('class','text-center align-middle');
        th.innerHTML="ID";
        etr1.appendChild(th);
        
        var th=document.createElement("th");
        th.innerHTML="";
        etr2.appendChild(th);
         
        var th=document.createElement("th");
        // th.rowSpan = '2';
        th.setAttribute('class','text-center align-middle');
        th.innerHTML="Name";
        etr1.appendChild(th);
        
        var th=document.createElement("th");
        th.innerHTML="";
        etr2.appendChild(th);
        
        //el3=document.createElement("th");el4=document.createElement("th");el3.innerHTML="H";el4.innerHTML="H";
        //el1.appendChild(el2);el1.appendChild(el3);el1.appendChild(el4);thead.appendChild(el1);mtable.appendChild(thead);
        // console.log(date);
        for (var i=1; i<=totdays;i++){
    
            var dayname=date.format('dddd').substring(0,2);
            var eth=document.createElement("th");
            eth.innerHTML=dayname;
            etr1.appendChild(eth);
            var eth1=document.createElement("th");
            eth1.innerHTML="D"+i;
            // eth1.innerHTML=i;
            etr2.appendChild(eth1);
            date=date.add(1, 'days');
            
        } // adding header value ends
        
        var th=document.createElement("th");th.innerHTML="PD";
        th.rowSpan = '2';
        th.setAttribute('class','text-center align-middle');
        etr1.appendChild(th);
        // th=document.createElement("th");etr2.appendChild(th);
        
        var th=document.createElement("th");th.innerHTML="HD";
        th.rowSpan = '2';
        th.setAttribute('class','text-center align-middle');
        etr1.appendChild(th);
        
        // th=document.createElement("th");etr2.appendChild(th);
        
        th=document.createElement("th");th.innerHTML="TH";
        th.rowSpan = '2';
        th.setAttribute('class','text-center align-middle');
        etr1.appendChild(th);
        // th=document.createElement("th");etr2.appendChild(th);
        
        //th=document.createElement("th");th.innerHTML="TL";etr1.appendChild(th);
        //th=document.createElement("th");etr2.appendChild(th);
        
        th=document.createElement("th");th.innerHTML="AD";
        th.rowSpan = '2';
        th.setAttribute('class','text-center align-middle');
        etr1.appendChild(th);
        // th=document.createElement("th");etr2.appendChild(th);
        
        th=document.createElement("th");th.innerHTML="TL";
        th.rowSpan = '2';
        th.setAttribute('class','text-center align-middle');
        etr1.appendChild(th);
        // th=document.createElement("th");etr2.appendChild(th);
        
        th=document.createElement("th");th.innerHTML="TD";
        th.rowSpan = '2';
        th.setAttribute('class','text-center align-middle');
        etr1.appendChild(th);
        // th=document.createElement("th");etr2.appendChild(th);
        
        thead.appendChild(etr1); 
        thead.appendChild(etr2);
        mtable.appendChild(thead);
        
        var tbody=document.createElement("tbody");
        var fromdate=moment(val,"YYYY-MM-DD");
        var todate=fromdate.clone().add(totdays-1,'days');
        //console.log(fromdate.format("YYYY-MM-DD"));console.log(todate.format("YYYY-MM-DD"));
       
        frappe.call({method:'attendance_monthly_report',
        
            args : {fromdate:fromdate.format("YYYY-MM-DD"),todate:todate.format("YYYY-MM-DD")},
            
            callback : (res)=>{
                
                // console.log(res);
                // console.log(res.message.woffs[0].weekly_off);
                
                var url=`/api/resource/Employee/?filters=[["status","=","Active"]]&fields=["employee","employee_name","department","company","default_shift","holiday_list","date_of_joining"]&limit_page_length=None`;
                
                // console.log(url);res.message.woffs[0].weekly_off
                
                var woff=res.message.woffs[0].weekly_off;
        
            fetch(url).then((r)=>r.json()).then((js)=>{// console.log(js);
               
                for (var j=0; j<js.data.length;j++){    // Get the employee related information
            
                    // doj=moment(js.data[j].date_of_joining,"YYYY-MM-DD");
                    
                    var etrb1=document.createElement("tr");
                    etrb1.setAttribute('class','trdata');
                    
                    var etdname=document.createElement("td");
                    etdname.setAttribute('class','tddata');
                    
                    etdname.innerHTML=js.data[j].employee;
                    // console.log(js.data[j].date_of_joining);
                    etdname.setAttribute("id",`${j}0`);
                    etrb1.appendChild(etdname);
                    
                    var etdname=document.createElement("td");
                    etdname.innerHTML=js.data[j].employee_name;
                    // console.log(js.data[j].date_of_joining);
                    etdname.setAttribute("id",`${j}0`);
                    etrb1.appendChild(etdname);
        
                    for (var k=1; k<=totdays;k++){
                        
                        var etd=document.createElement("td");
                        //etd.innerHTML=k;
                        //console.log(fromdate.clone().add(k,'days').format("dddd"));
                        if(fromdate.clone().add(k-1,'days').format("dddd")==woff){
                            
                            //console.log(fromdate.clone().add(k,'days').format("dddd"));
                            etd.innerHTML="WO";
                            
                        } // if ends here
                        
                        else {
                            
                            etd.innerHTML="";
                            
                        } // else ends here
                        //etd.setAttribute("id",`${j}${k}`);etrb1.appendChild(etd);
                        etd.setAttribute("id",`e${j}d${k}`);
                        etd.setAttribute("class",`text-center`);
                        etrb1.appendChild(etd);
                        
                    } // for loop ends here
                    
                    var td=document.createElement("td");td.setAttribute('class',`text-center`);td.setAttribute('id','pd'+j);etrb1.appendChild(td);
                    td=document.createElement("td");td.setAttribute('class',`text-center`);td.setAttribute('id','hdp'+j);etrb1.appendChild(td);
                    td=document.createElement("td");td.setAttribute('class',`text-center`);td.setAttribute('id','th'+j);etrb1.appendChild(td);
                    
                    td=document.createElement("td");td.setAttribute('class',`text-center`);td.setAttribute('id','ad'+j);etrb1.appendChild(td);
                    td=document.createElement("td");td.setAttribute('class',`text-center`);td.setAttribute('id','tl'+j);etrb1.appendChild(td);
                    td=document.createElement("td");td.setAttribute('class',`text-center`);td.setAttribute('id','td'+j);etrb1.appendChild(td);
                    
                    tbody.appendChild(etrb1);
                        
                } // end for j
                
                    mtable.appendChild(tbody);
                    var wday=moment(res.message.attendance[0].WorkDate,"YYYY-MM-DD");
                    
                    // This loop is used to decide fromdate and todate for getting leave balance
                    
                    var day=wday.date(); var from_date;var to_date;
                    
                    for (var w=0; w<res.message.woffs.length;w++){
                        
                        from_date=moment(res.message.woffs[w].from_date,"YYYY-MM-DD");
                        to_date=moment(res.message.woffs[w].to_date,"YYYY-MM-DD");
                        //console.log("from start date " + from_date.diff(wday,"days"));
                        //console.log(wday.format("YYYY-MM-DD"));
                        //console.log("from end date " + to_date.diff(wday,"days"));
                        
                        if (from_date.diff(wday,"days")<=0 && to_date.diff(wday,"days")>0){
                            
                            break;
                        
                        } // if ends here
                        
                    } // for loop ends here
                    
                    for (j=0;j<js.data.length;j++){
                        
                        var doj=moment(js.data[j].date_of_joining,"YYYY-MM-DD");
                        var company=js.data[j].company;
                        var shift=js.data[j].default_shift;
                        var countp=0;var countlwp=0;var counta=0; var countwop=0; var countpl=0;
                        var countwopl=0;
                        var countal=0;var countwoal=0;
                        //this loop is used for placing employee attendance record
                        
                        for (var l=0;l<res.message.attendance.length;l++){
                            
                            wday=moment(res.message.attendance[l].WorkDate,"YYYY-MM-DD");
                            day=wday.date();
                            
                            if (js.data[j].employee==res.message.attendance[l].Employee){
                                
                                var el=document.getElementById(`e${j}d${day}`);
                                // el.setAttribute("class",`text-center`);
                                var btn=document.createElement("button");
                                var ol=el.innerHTML;
                             
                                if(res.message.attendance[l].Status=="P"){
                                    
                                    if(ol.trim().length==0){
                                       
                                        el.innerHTML= el.innerHTML+"<span class='text-dark'>"+res.message.attendance[l].Status+"</span>";
                                        
                                    } // if ends here
                                    
                                    else{
                                        
                                        el.innerHTML= el.innerHTML +"/"+"<span class='text-dark'>"+res.message.attendance[l].Status+"</span>";
                                        
                                    } // else ends here 
                                    
                                } // if ends here
        
                                else if(res.message.attendance[l].Status=="A"){
                                    
                                    if(ol.trim().length==0){
                                       
                                        el.innerHTML= el.innerHTML+"<span class='text-danger'>"+res.message.attendance[l].Status+"</span>";
                                        
                                    } // if ends here
                                    
                                    else{
                                        
                                        el.innerHTML= el.innerHTML +"/"+"<span class='text-danger'>"+res.message.attendance[l].Status+"</span>";
                                        
                                    } // else ends here 
                                    countlwp+=1;
                                    
                                } // else if ends here
        
                                else {
                                
                                    if(ol.trim().length==0){
                                        
                                        el.innerHTML= el.innerHTML+res.message.attendance[l].Status;
                                        
                                    } else {
                                        
                                        el.innerHTML= el.innerHTML +"/"+res.message.attendance[l].Status;
                                        
                                    } // else ends here
                                    
                                } // else ends here
                                
                                var att=JSON.stringify(res.message.attendance[l]);
                                //var start=moment(res.message.woffs[0].from_date,"YYYY-MM-DD");
                                el.setAttribute("onclick","showDetails('"+att+"','"+company+"','"+shift+"','"+from_date.format("YYYY-MM-DD")+"','"+to_date.format("YYYY-MM-DD")+"')");
                            }//end if
                        }//end for l
                        //this loop is used for placing employee leave record
                        for (var m=0;m<res.message.leaves.length;m++){
                            
                            if (js.data[j].employee==res.message.leaves[m].employee){
                                
                                for (var d=moment(res.message.leaves[m].from_date,"YYYY-MM-DD");d<=moment(res.message.leaves[m].to_date,"YYYY-MM-DD");d.add(1,"days")){
                                    
                                    var lday=d.date();
                                    var el1=document.getElementById(`e${j}d${lday}`);
                                    // el1.setAttribute("class",`text-center`);
                                    var sl=el1.innerHTML;
                                    // console.log(sl.length);
                                    if(sl.length==0) {
                                        
                                        if (res.message.leaves[m].status==="Approved"){el1.innerHTML=el1.innerHTML+"L";}
                                        else if (res.message.leaves[m].status==="Open"){el1.innerHTML=el1.innerHTML+"O";}
                                        else if (res.message.leaves[m].status==="Rejected"){el1.innerHTML=el1.innerHTML+"R";}
                                        else if (res.message.leaves[m].status==="Cancelled"){el1.innerHTML=el1.innerHTML+"C";} 
                                        
                                    } // if ends here
                                    
                                    else {
                                        
                                        if (res.message.leaves[m].status==="Approved"){el1.innerHTML=el1.innerHTML+"/"+"L";}
                                        else if (res.message.leaves[m].status==="Open"){el1.innerHTML=el1.innerHTML+"/"+"O";}
                                        else if (res.message.leaves[m].status==="Rejected"){el1.innerHTML=el1.innerHTML+"/"+"R";}
                                        else if (res.message.leaves[m].status==="Cancelled"){el1.innerHTML=el1.innerHTML+"/"+"C";}
                                        
                                    } // else ends here
                                    
                                    if (res.message.leaves[m].leave_type==="Leave Without Pay") {
                                        
                                        countlwp+=1;
                                        
                                    } // if ends here
                                    
                                    //el1.setAttribute("onclick","showDetailsLeave()");
                                    // console.log(j);
                                    // console.log(res.message.leaves[m].employee);
                                    // console.log(d.format("DD-MM-YYYY"));
                                    // console.log(res.message.leaves[m].status);
                                    
                                } // for loop ends here
                            } // if ends here
                        }//end for m
                        //use res.message.holidays
                        for ( m=0;m<res.message.holidays.length;m++){
                            
                            var d1=moment(res.message.holidays[m].holiday_date,"YYYY-MM-DD");
                            var hday=d1.date();
                            var el2=document.getElementById(`e${j}d${hday}`);
                            // el2.setAttribute("class",`text-center`);
                            el2.innerHTML="H";
                            
                        }//end for m
                        
                        // filling the remaining field with A
                        
                        for (var k=1; k<=totdays;k++){
                            
                            var etd=document.getElementById(`e${j}d${k}`);
                            etd.setAttribute("class",`text-center`);//etd.innerHTML=k;js.data[j].employee
                            var d2=date.format("YYYY-")+ date.month() + `-${k}`;
                            // console.log(moment().diff(moment(d2,"YYYY-MM-DD")));
                            var att=`{"Employee":"${js.data[j].employee}","EmployeeName":"${js.data[j].employee_name}","WorkDate":"${d2}","FirstIn":"00:00","LastOut":"00:00:00","LateIn":"0","EarlyOut":"0","duration":""}`;
                                
                            if (etd.innerHTML==""){
                                //console.log("AAA");
                                //console.log(js.data[j].date_of_joining);
                                //console.log(moment(d2,"YYYY-MM-DD").diff(doj,'days'));
                                
                                // console.log(doj);
                                //to take care that filling date is more than doj
                                
                                    if((moment(d2,"YYYY-MM-DD").diff(doj))>=0){
                                       
                                       if(moment().diff(moment(d2,"YYYY-MM-DD"))>0) {
                                           
                                            etd.setAttribute("class","text-danger text-center");
                                            etd.innerHTML="A";
                                            etd.setAttribute("onclick","showDetails('"+att+"','"+company+"','"+shift+"','"+from_date.format("YYYY-MM-DD")+"','"+to_date.format("YYYY-MM-DD")+"')");
                                            
                                        } // if ends here 
        
                                // if(moment().diff(moment(d2,"YYYY-MM-DD"))>0) {
                                // etd.setAttribute("class","text-danger");
                                // etd.innerHTML="A";
                                // etd.setAttribute("onclick","showDetails('"+att+"','"+company+"','"+shift+"','"+from_date.format("YYYY-MM-DD")+"','"+to_date.format("YYYY-MM-DD")+"')");
                                // }
                            } // if ends here
                            } // if ends here
                            //etd.setAttribute("id",`${j}${k}`);//etrb1.appendChild(etd);
                        }//end for k
                    
                        for (var k=1; k<=totdays;k++){
                            
                            var etdc=document.getElementById(`e${j}d${k}`);
                            //console.log(etdc.innerHTML);
                            if (etdc.innerHTML=="A"){
                                
                                countlwp+=1;
                                
                            } // if ends here
                            
                            // else if (etdc.innerHTML=="WO/" + "<span class='text-dark'>" + "P" + "</span>"){
                            //     alert("1");
                            //     countwop+=1;
                                
                            // } // if ends here
                            
                            else if (etdc.innerHTML=="P/L"){
                                
                                countpl+=1;
                                
                            } // if ends here
                            
                            // if (etdc.innerHTML=="WO/P/L"){
                            //     alert("3");
                            //     countwopl+=1;
                                
                            // } // if ends here
                            
                            // if (etdc.innerHTML=="A/L"){
                            //     alert("4");
                            //     countal+=1;
                                
                            // } // if ends here
                            
                            
                            // if (etdc.innerHTML=="WO/A/L"){
                            //     alert("5");
                            //     countwoal+=1;
                                
                            // } // if ends here
                            
                            
                        } // for loop ends here
                        //   total days  
                    
                        var twdays=totdays;
                        
                        if (moment(d2,"YYYY-MM-DD").diff(doj,'days')<totdays){
                            
                            twdays=moment(d2,"YYYY-MM-DD").diff(doj,'days')+1;
                            
                            if(twdays<0){
                                
                                twdays=0;
                                
                            } // if ends here
                            
                            else {
                                
                                twdays=twdays;
                                
                            } // else ends here
                            
                        } // if ends here
                        
                        // present days
                        
                        var countp=0;
                        for (var p=0;p<res.message.attendance_one.length;p++){
                            
                            var citem=res.message.attendance_one[p];
                            
                            if(js.data[j].employee==citem.Employee){
                                
                                countp=citem.No_of_Present_Days;
                                 
                            } // if ends here
                            
                        } // for loop ends here
                        
                        // present days
                        
                        var counthdp=0;
                        for (var h=0;h<res.message.attendance_two.length;h++){
                            
                            var ditem=res.message.attendance_two[h];
                            
                            if(js.data[j].employee==ditem.Employee){
                                
                                counthdp=ditem.No_of_Present_Days;
                                 
                            } // if ends here
                        } // for loop ends here
                        
                        // count weekly off 
                        
                        var countwo=0;
                        
                        for (var k=1; k<=totdays;k++){
                            
                            var rd = fromdate.clone().add(k-1,'days');
                            
                            var difference = rd.diff(doj,"days");
                            
                            if(rd.format("dddd")==woff){
                                
                                if(difference>=0){
                                    
                                    countwo+=1;
                                    
                                } // if ends here
                            } // if ends here
                        } // for loop ends here
                        
                        // count national holiday
                        
                        var counth=0; var holiday=0;
                        for (var s=1; s<=totdays;s++){
                            
                            var rd_ho = fromdate.clone().add(s-1,'days');
                            var difference_ho = rd_ho.diff(doj,"days");
                            for (var m=0;m<res.message.holidays.length;m++){
                                
                                if(rd_ho.format("YYYY-MM-DD")==(res.message.holidays[m].holiday_date)){
                                    
                                    if(difference_ho>=0){
                                        
                                        // alert("chinchu");
                                        counth+=1;
                                        
                                    } // if ends here
                                } // if ends here
                            } // for loop ends here
                        } // for loop ends here
                        
                        holiday=(counth-countwo);
                        
                        if (holiday<0){
                            
                           holiday=0; 
                           
                        } // if ends here
                        
                        else{
                            
                            holiday=holiday;
                            
                        } // else ends here
                        
                        // count leave
                        
                        var countal=0;
                        for (var m=0;m<res.message.leaves.length;m++){
                            
                            if (js.data[j].employee==res.message.leaves[m].employee){
                                
                                if (res.message.leaves[m].status==="Approved"){
                                    
                                        countal+=1;
                                     
                                } // if ends here
                            } // if ends here
                        } // end for m
                        
                        // $(`#tot${j}`).html(twdays);
                        // $(`#lwp${j}`).html(countlwp);
                        // $(`#p${j}`).html(pdays);
                        
                        $(`#pd${j}`).html(countp);
                        $(`#hdp${j}`).html(counthdp);
                        $(`#th${j}`).html(countwo+holiday-(countwop+countwopl+countwoal));
                        $(`#ad${j}`).html(countlwp);
                        $(`#tl${j}`).html(countal);
                        $(`#td${j}`).html(twdays);
                      
                    } // end for j
                    
            });//end for employee fetch 
        }//end for callback res
        });//end for monthly attendance fetch
    
        // var download_one = document.getElementById("download_one");                       
        // download_one.parentNode.removeChild(download_one);
        // var download_two = document.getElementById("download_two");
        // download_two.style.display="block";
        
        //var c = document.getElementById("monthly_attendance_table").innerHTML;    // Getting the value of Attendance History Table
        //var d = document.getElementById("newTabletwo");                           // Getting the value of New Table
        //d.innerHTML = c;                                                          // Setting the value of Attendance History Table into New Table
        
    } // function ends here

    // Historical Attendance
    
    $(document).ready(()=>{
        
        fillSelectMonth();     // Calling the function of month selection for Attendance Summary Report
        fillSelectMonth_one(); // Calling the function of month selection for Daily Production Report
        
        //console.log(frappe.user_id);
        
        if (frappe.user_id==="Guest"){
            
            window.location.assign("/login");
            
        } // if ends here
       
        $.getScript("../assets/hr/js/jquery-3.5.1.min.js",()=>{
        $.getScript("../assets/hr/js/datepicker/date-picker/datepicker.js",()=>{
        $.getScript("../assets/hr/js/datepicker/date-picker/datepicker.en.js");
        $.getScript("../assets/hr/js/datepicker/date-picker/datepicker.custom.js");
        
        });//end datepicker.js
        
    }); // end of jquery
    
    // Calling attendance function from 60 days back to current date
    
    attendance(moment().subtract(60 ,"days").format("YYYY-MM-DD"),moment().format("YYYY-MM-DD"));
     
    }); //end windows.ready
    
    // Display of attendance data for last sixty days

    function showDataOnTabChange(){
        
        attendance(moment().subtract(60 ,"days").format("YYYY-MM-DD"),moment().format("YYYY-MM-DD"));
        
    } // function ends here

    // Employee information at the Right Corner

    frappe.ready(() => {
    
        var url=`/api/resource/Employee/?filters=[["user_id","=","${frappe.user_id}"]]&fields=["image","first_name","department"]`;
        // console.log(url);
        
        fetch(url).then((r)=>r.json()).then((js)=>{//console.log(js);
        var item=js.data[0];
        
            // document.getElementById("nav_user").setAttribute("src",item.image);
            document.getElementById("nav_name").innerHTML=item.first_name;
            document.getElementById("de").innerHTML=item.department;
        
        }); // fetch url ends here
            
    }); // frappe.ready ends here

    //  Employee image at the Right Corner

    frappe.ready(() => {
        
        var url=`/api/resource/Employee/?filters=[["user_id","=","${frappe.user_id}"]]&fields=["image","first_name"]`;
        
        fetch(url).then((r)=>r.json()).then((js)=>{//console.log(js);
        
            var item=js.data[0];
        
            if (item.image){
        
                var a=document.getElementById("nav_user");
                a.setAttribute("class","border");
                a.setAttribute("src",item.image);
                
            } // if ends here
            
            else {
                
                var sn=item.first_name.substring(0,2).toUpperCase();
                var b=document.getElementById("nav_user");
                b.setAttribute("class","border");
                b.setAttribute("src",generated(sn));
                
            } // else ends here
            
            document.getElementById("nav_name").innerHTML=item.first_name;
        
        }); // fetch url ends here
    
        function generated(name) {
         
            let canvas = document.createElement('canvas');
          
            canvas.height = 180;
            canvas.width  = 180;
          
            let context = canvas.getContext('2d');
          
            //context.drawImage(this.poster, 0, 0)
            context.fillStyle = "#eef0f2";
            context.fillRect(0, 0, canvas.width, canvas.height);
          
            context.font = "50px Arial";
            context.fillStyle="black";
            context.fillText(name, 50, 95);
          
            return canvas.toDataURL('image/jpeg');
          
        } // function ends here
        
    }); // frappe.ready ends here

    //  Download in CSV - Version One

    // function downloadCSV() {
        
    //     createNewTable() // calling the function to generate a new table
        
    //     // Get the table data
        
    //     var table = document.querySelectorAll('table')[0];
        
    //     if (document.getElementById("newTableOne").getAttribute("style")){
            
    //         table = document.querySelectorAll('table')[1];
            
    //     } // if ends here
        
    //     const rows = table.querySelectorAll('tr');

    //     // Build the CSV data
        
    //     let csv = '';
        
    //     for (let i = 0; i < rows.length; i++) {
            
    //         var cells = rows[i].querySelectorAll('td');
            
    //         if (cells.length===0){
                
    //             cells = rows[i].querySelectorAll('th');
                
    //         } // if ends here
        
    //       let row = '';
          
    //         if (rows[i].style.display!="none"){
              
    //             for (let j = 0; j < cells.length; j++) {
                  
    //                 row += cells[j].textContent.replaceAll(",","|") + ',';
                
    //             } // for loop ends here
            
    //         csv += row + '\r\n';
          
    //         } // if ends here
          
    //     } // for loop ends here

    //     // Download the CSV file
        
    //     const link = document.createElement('a');
    //     link.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv));
    //     link.setAttribute('download', 'Detailed_employee_attendance.csv');
    //     link.click();
        
    // } // function ends here
    
    // Download in CSV - Version Two
  
    // function downloadCSV() {
        
    //     // Get the DataTable instance
          
    //     var table = $('#attendance_history_table').DataTable();
        
    //     // Get the filtered data from the DataTable
          
    //     var filteredData = table.rows({ search: 'applied' }).data();
        
    //     // Get the column names
          
    //     var columns = table.columns().header().toArray().map(function (th) {
    //         return th.textContent;
    //     });
        
    //     // Create the CSV content
          
    //     var csvContent = columns.join(',') + '\n';
    //     filteredData.each(function (rowData) {
    //     csvContent += rowData.join(',') + '\n';
        
    //     });
        
    //     // Create a temporary download link
          
    //     var link = document.createElement('a');
    //     link.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csvContent);
    //     link.download = 'Detailed_employee_attendance.csv';
        
    //     // Trigger the download
          
    //     link.click();
      
    // } // function ends here
    
    // Download in CSV - Version Three
    
    function downloadCSV() {
        
        // Get the DataTable instance
        
        var table = $('#attendance_history_table').DataTable();
            
        // Get the filtered data from the DataTable
        
        var filteredData = table.rows({ search: 'applied' }).data();
            
        // Get the column names
        
        var columns = table.columns().header().toArray().map(function (th) {
            
            return th.textContent;
            
        }); // function ends here
            
        // Create the CSV content with visually centered data
        
        var csvContent = columns.map(function(column) {
            
            return '"' + centerAlign(column) + '"';
            
        }).join(',') + '\n';
    
        filteredData.each(function (rowData) {
            
            var row = rowData.map(function(cell) {
                
                return '"' + centerAlign(cell) + '"';
                
            }).join(',');
            
            csvContent += row + '\n';
            
        }); // function ends here
            
        // Create a temporary download link
        
        var link = document.createElement('a');
        link.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csvContent);
        link.download = 'Detailed_employee_attendance.csv';
            
        // Trigger the download
        
        link.click();
        
    } // function ends here

    function centerAlign(text) {
        
        var maxLength = 12;
        var padding = Math.max(0, maxLength - text.length);
        var leftPadding = Math.floor(padding / 2);
        var rightPadding = padding - leftPadding;
        return ' '.repeat(leftPadding) + text + ' '.repeat(rightPadding);
        
    } // function ends here

    // Role Specific
    
    // frappe.ready(() =>{    
        
    //     frappe.call({
    //                 method: 'has_role',
    //                 args: {'role_name' : 'HR Manager'},
    //                 callback: function(r){
    //                     // console.log(r);
    //                     if(r.message.length>0){
                            
    //                         document.getElementById('Efficiency_report_data_hr_re').style.display = 'block';
    //                         document.getElementById('Capacity_utilisation_report_data_hr_re').style.display = 'block';
    //                         document.getElementById('attendance_report_for_payroll_processing_without_considering_over_time_data_hr_re').style.display = 'block';
    //                         document.getElementById('attendance_report_for_payroll_processing_considering_over_time_data_hr_re').style.display = 'block';
    //                         document.getElementById('muster_roll_report').style.display = 'block';
    //                         document.getElementById('monthwise_attendance_report').style.display = 'block';
    //                         // document.getElementById('all_emp_re').style.display = 'block';
    //                     } // if ends here
    //                     else{
    //                          document.getElementById('Efficiency_report_data_hr_re').style.display = 'none';
    //                          document.getElementById('Capacity_utilisation_report_data_hr_re').style.display = 'none';
    //                          document.getElementById('attendance_report_for_payroll_processing_without_considering_over_time_data_hr_re').style.display = 'none';
    //                          document.getElementById('attendance_report_for_payroll_processing_considering_over_time_data_hr_re').style.display = 'none';
    //                         document.getElementById('muster_roll_report').style.display = 'none';
    //                         document.getElementById('monthwise_attendance_report').style.display = 'none';
    //                         // document.getElementById('all_emp_re').style.display = 'none';
    //                     } // else ends here
    //                 } // callback ends here
    //             }); //frappe.call ends here
    // }); // frappe.ready ends here

    //  Download in Excel

    // function exportToExcel() {
        
    //     createNewTable() // calling the function to generate a new table
        
    //     var table = document.getElementById("newTableOne");
    //     var workbook = XLSX.utils.table_to_book(table, {sheet:"Sheet 1"});
    //     var excelBuffer = XLSX.write(workbook, {bookType:'xlsx', type:'array'});
    //     saveAsExcel(excelBuffer, "Detailed_employee_attendance.xlsx");
        
    // } // function ends here
    
    // function exportToExcel() {
        
    //     createNewTable(); // calling the function to generate a new table
        
    //     var table = document.getElementById("newTableOne");
        
    //     var rowCount = table.rows.length;
        
    //     table.deleteRow(rowCount -1);
        
    //     var workbook = XLSX.utils.table_to_book(table, { sheet: "Sheet 1" });
        
    //     var excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
        
    //     saveAsExcel(excelBuffer, "Detailed_employee_attendance.xlsx");
        
    //     document.body.removeChild(table); // Remove the newly generated table from the DOM
        
    // } // function ends here

    // function saveAsExcel(buffer, filename) {
        
    //     var blob = new Blob([buffer], {type: 'application/octet-stream'});
    //     var url = window.URL.createObjectURL(blob);
    //     var link = document.createElement('a');
    //     link.href = url;
    //     link.setAttribute('download', filename);
    //     document.body.appendChild(link);
    //     link.click();
    //     document.body.removeChild(link);
        
    // } // function ends here

    // Version Two - Type One

    // function exportToExcel() {
        
    //     // Get the DataTable instance
    //       var table = $('#attendance_history_table').DataTable();
        
    //       // Get the filtered data from the DataTable
    //       var filteredData = table.rows({ search: 'applied' }).data();
        
    //       // Create a new workbook
    //       var workbook = XLSX.utils.book_new();
        
    //       // Create a new worksheet
    //       var worksheet = XLSX.utils.json_to_sheet(filteredData.toArray(), { header: getTableHeaders() });
        
    //       // Add the worksheet to the workbook
    //       XLSX.utils.book_append_sheet(workbook, worksheet, 'Sheet1');
        
    //       // Convert the workbook to Excel format
    //       var excelData = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
        
    //       // Create a Blob from the Excel data
    //       var blob = new Blob([excelData], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
        
    //       // Create a temporary download link
    //       var link = document.createElement('a');
    //       link.href = window.URL.createObjectURL(blob);
    //       link.download = 'datatable.xlsx';
        
    //       // Trigger the download
    //       link.click();
    //     }
        
    //     function getTableHeaders() {
    //       var headers = [];
    //       $('#attendance_history_table thead th').each(function () {
    //         headers.push($(this).text());
    //       });
    //       return headers;
        
    // } // function ends here

    // Version Two - Type Two
    
    // function exportToExcel() {
        
    //       // Get the DataTable instance
    //       var table = $('#attendance_history_table').DataTable();
        
    //       // Get the filtered data from the DataTable
    //       var filteredData = table.rows({ search: 'applied' }).data();
          
    //       console.log(filteredData);
        
    //       // Create a new workbook
    //       var workbook = XLSX.utils.book_new();
        
    //       // Create a new worksheet
    //       var worksheet = XLSX.utils.json_to_sheet(filteredData.toArray(), { header: getTableHeaders() });
        
    //       // Add the worksheet to the workbook
    //       XLSX.utils.book_append_sheet(workbook, worksheet, 'Sheet1');
        
    //       // Convert the workbook to Excel format
    //       var excelData = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
        
    //       // Create a Blob from the Excel data
    //       var blob = new Blob([excelData], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
        
    //       // Create a temporary download link
    //       var link = document.createElement('a');
    //       link.href = window.URL.createObjectURL(blob);
    //       link.download = 'datatable.xlsx';
        
    //       // Trigger the download
    //       link.click();
    //     }
        
    //     function getTableHeaders() {
    //       var headers = [];
    //       $('#attendance_history_table thead th').each(function () {
    //         headers.push($(this).text());
    //       });
    //       return headers;
        
    // } // function ends here
    
    // Version Three
    
    // Export to Excel file without Applied Filter
    
    function exportToExcel() {
        
        // createNewTable() // calling the function to generate a new table
        
        // var table = document.getElementById("newTableOne");
        
        var table = document.getElementById("attendance_history_table");
        
        var rowCount = table.rows.length;
        
        table.deleteRow(rowCount -1);
        
        var workbook = XLSX.utils.table_to_book(table, { sheet: "Sheet 1" });
        
        var excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
        
        saveAsExcel(excelBuffer, "Detailed_employee_attendance.xlsx");
        
        document.body.removeChild(table); // Remove the newly generated table from the DOM  
        
    } // function ends here

    // Save the Excel file without Applied Filter

    function saveAsExcel(buffer, filename) {
        
        var blob = new Blob([buffer], {type: 'application/octet-stream'});
        
        var url = window.URL.createObjectURL(blob);
        
        var link = document.createElement('a');
        
        link.href = url;
        
        link.setAttribute('download', filename);
        
        document.body.appendChild(link);
        
        link.click();
        
        document.body.removeChild(link);
        
    } // function ends here
    
    // Version Four

    // Export to Excel file without Applied Filter
    
    // function exportToExcel() {
        
    //     var table = document.getElementById("attendance_history_table");
    //     var rowCount = table.rows.length;
        
    //     table.deleteRow(rowCount - 1);
        
    //     // Clone the table to avoid modifying the original table
        
    //     var clonedTable = table.cloneNode(true);
        
    //     // Loop through the cloned table to format date cells
        
    //     for (var i = 1; i < clonedTable.rows.length; i++) {
            
    //         var dateCell = clonedTable.rows[i].cells[0];
    //         var dateString = dateCell.textContent;        
    //         var formattedDate = formatDate(dateString);
    //         dateCell.textContent = formattedDate;
            
    //     } // for loop ends here
        
    //     var workbook = XLSX.utils.table_to_book(clonedTable, { sheet: "Sheet 1" });
    //     var excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
        
    //     saveAsExcel(excelBuffer, "Detailed_employee_attendance.xlsx");
        
    // } // function ends here
    
    // Save the Excel file without Applied Filter
    
    // function saveAsExcel(buffer, filename) {
        
    //     var blob = new Blob([buffer], { type: 'application/octet-stream' });
    //     var url = window.URL.createObjectURL(blob);
    //     var link = document.createElement('a');
    //     link.href = url;
    //     link.setAttribute('download', filename);
    //     document.body.appendChild(link);
    //     link.click();
    //     document.body.removeChild(link);
        
    // } // function ends here
    
    // Adjust the date format in the downloaded copy
    
    // function formatDate(dateString) {
        
    //     var parts = dateString.split('/');
    //     if (parts.length === 3) {
            
    //         var day = parts[0];
    //         var month = parts[1];
    //         var year = parts[2];
            
    //         // Construct a new date string in "MM/DD/YYYY" format
            
    //         var formattedDate = month + '/' + day + '/' + year;
    //         return formattedDate;
            
    //     } // if ends here
        
    //     else {
            
    //         // Return the original date string if the input format is not as expected
            
    //         return dateString;
            
    //     } // else ends here
        
    // } // function ends here
    
    // Export to Excel file with Applied Filter (Date Range)
    
    function exportToExcelWithFilter() {
        
        var table = document.getElementById("attendance_history_table");
        
        // console.log(table);
        
        var rowCount = table.rows.length;
        
        table.deleteRow(rowCount -1);
        
        var workbook = XLSX.utils.table_to_book(table, { sheet: "Sheet 1" });
        
        var excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
        
        saveAsExcelWithFilter(excelBuffer, "Detailed_employee_attendance.xlsx");
        
        document.body.removeChild(table); // Remove the newly generated table from the DOM

    } // function ends here
    
    // Save the Excel file with Applied Filter (Date Range)

    function saveAsExcelWithFilter(buffer, filename) {
        
        var blob = new Blob([buffer], {type: 'application/octet-stream'});
        
        var url = window.URL.createObjectURL(blob);
        
        var link = document.createElement('a');
        
        link.href = url;
        
        link.setAttribute('download', filename);
        
        document.body.appendChild(link);
        
        link.click();
        
        document.body.removeChild(link);
        
    } // function ends here
    
    // Export to Excel file with Applied Filter (Table Filter)
    
    function exportToExcelWithTableFilter() {
    
        var table = document.getElementById("attendance_history_table");
    
        var rowCount = table.rows.length;
    
        table.deleteRow(rowCount - 1);
    
        var workbook = XLSX.utils.table_to_book(table, { sheet: "Sheet 1" });
    
        var excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
    
        saveAsExcelWithTableFilter(excelBuffer, "Detailed_employee_attendance.xlsx");
    
        document.body.removeChild(table); // Remove the newly generated table from the DOM
      
    } // function ends here

    // Save the Excel file with Applied Filter (Table Filter)
    
    function saveAsExcelWithTableFilter(buffer, filename) {
        
      var blob = new Blob([buffer], { type: 'application/octet-stream' });
    
      var url = window.URL.createObjectURL(blob);
    
      var link = document.createElement('a');
      link.href = url;
      link.setAttribute('download', filename);
    
      document.body.appendChild(link);
    
      link.click();
    
      document.body.removeChild(link);
      
    } // function ends here

    // Check if any filter is applied or not & download the table accordingly in Excel format
    
    function checkAndDownloadInExcel() {
        
        var from_date =         $(".datepicker-here")[0].value;
        var to_date =           $(".datepicker-here")[1].value;
        var date =              $("#filter1").val();    // console.log(date);
        var month =             $("#filter2").val();    // console.log(month);  
        var id =                $("#filter3").val();    // console.log(id);
        var name =              $("#filter4").val();    // console.log(name);
        var first_checkin =     $("#filter5").val();    // console.log(first_checkin);
        var last_checkout =     $("#filter6").val();    // console.log(last_checkout);
        var late_by =           $("#filter7").val();    // console.log(late_by);
        var early_by =          $("#filter8").val();    // console.log(early_by);
        var duration =          $("#filter9").val();    // console.log(duration);
        var location =          $("#filter10").val();   // console.log(location);

        
        if(from_date.length > 0 && to_date.length > 0){
            
            exportToExcelWithFilter() // Call the function to download the table with date range filter
            
        } // if ends here
        
        else if (date.length > 0 || month.length > 0 || id.length > 0 || name.length > 0 || first_checkin.length > 0 ||
        
            last_checkout.length > 0 || late_by.length > 0 || early_by.length > 0 || duration.length > 0 || location.length > 0){
            
            exportToExcelWithTableFilter() // Call the function to download the table with applied table filter/s.
            
        } // else if ends here
            
        else {
            
            exportToExcel() // Call the function to download the table without any filter.
            
        } // else ends here
        
    } // function ends here

    // Creation of a new table with selected columns for PDF download
    
    function createNewTable(){
        
        var newTable = document.getElementById('newTableOne'); // Create a new table 
    
        var existingTable = document.getElementById('newTable'); // Get reference to the existing table
    
        var selectedColumns = [0,2,3,4,5,6,7,8,9]; // Get the column indices you want to include in the new table
    
        for (var i = 0; i < existingTable.rows.length; i++) { // Iterate over the rows in the existing table
        
            var newRow = document.createElement('tr'); // Create a new row for the new table
            var existingRow = existingTable.rows[i]; // Get the corresponding row from the existing table
            
        for (var j = 0; j < selectedColumns.length; j++) { // Iterate over the selected columns
        
            var columnIndex = selectedColumns[j];
            var existingCell = existingRow.cells[columnIndex]; // Get the corresponding cell from the existing row
    
            var newCell = document.createElement('td'); // Create a new cell for the new table
            newCell.innerHTML = existingCell.innerHTML; // Copy the data from the existing cell
            
            newRow.appendChild(newCell); // Append the new cell to the new row
            
        } // for loop for j ends here
        
            newTable.appendChild(newRow); // Append the new row to the new table
            
        } // for loop for i ends here
        
    } // function ends here
    
    // Download in PDF without any filter
    
    function exportToPDF(){
        
        createNewTable() // calling the function to generate a new table
    
        $.getScript("https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js",()=>{ // calling the cdn for jsPDF
        $.getScript("https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.6/jspdf.plugin.autotable.min.js",()=>{ // calling the cdn for autotable
        
        var doc = new jsPDF('L', 'pt', 'letter');  
        var htmlstring = '';  
        var tempVarToCheckPageHeight = 0;  
        var pageHeight = 0;  
        // pageHeight = doc.internal.pageSize.height; 
        pageHeight = 2000; 
        
        specialElementHandlers = {  
            
            '#bypassme': function(element, renderer) {  
        
                return true  
                
            } // function ends here
            
        }; // Special Element Handler ends here
        
        margins = {  
            
            top: 150,
            width: 1500 
            
        };  // Margin ends here
        
        var y = 20;  
        doc.setLineWidth(0.5);
        doc.text(250, y = y + 20, "Detailed Employee Attendance - GewinssHR");
        
        doc.autoTable({  
            
            html: '#newTableOne',  
            startY: 70,  
            theme: 'grid',
            fontSize: 6,
            
            didParseCell: function (data) {
                
                // Check if the cell belongs to the header row
                
                if (data.row.index === 0) {
                  
                  data.cell.styles.fontStyle = 'bold';
                  data.cell.styles.halign = 'center';
                  data.cell.styles.fillColor = '#D3D3D3';
                  data.cell.styles.fontSize = 8;
                  
                } // if ends here
            },

            columnStyles: {
                
                cellWidth: 50, // set the cell width
                fontStyle: 'bold',
                
                }, // column style ends here
                
            styles: {  
                
                minCellHeight: 15,  // set the minimum cell height
            
            },  // styles end here
            
        })  // doc.autotable ends here
        
        doc.save('Detailed_employee_attendance.pdf'); // Save the report in pdf format
        
        }); // end of jspdf.min.js
        }); // jspdf.plugin.autotable.min.js
    
    } // function ends here

    // Download in PDF with any sort of filter
    
    function exportToPDFWithFilters() {
        
        $.getScript("https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js", () => { // calling the cdn for jsPDF
        $.getScript("https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.6/jspdf.plugin.autotable.min.js", () => { // calling the cdn for autotable
    
        var doc = new jsPDF('l', 'pt', 'letter');
        var htmlstring = '';
        var tempVarToCheckPageHeight = 0;
        var pageHeight = 0;
        pageHeight = doc.internal.pageSize.height;
    
            specialElementHandlers = {
              
                '#bypassme': function (element, renderer) {
                    
                    return true;
                    
                } // function ends here
                
            }; // end of specialElementHandlers
    
            margins = {
                  
                top: 150,
                bottom: 30,
                width: 1500
                
            }; // margin ends here
    
            var y = 20;
            doc.setLineWidth(0.5);
            doc.text(250, y += 20, "Detailed Employee Attendance - GewinssHR");
    
            var filteredData = [];
            
            var tableRows = $('#attendance_history_table').find('tbody tr'); // Replace 'yourTableId' with the actual ID of your table
            
            tableRows.each(function () {
                
                var rowData = [];
                
                $(this).find('td').each(function () {
                    
                  rowData.push($(this).text());
                  
                }); // function ends here
            
                filteredData.push(rowData);
            
            }); // function ends here
    
            var header = ["Date", "Month", "Id", "Name", "First Checkin", "Last Checkout", "Late By", "Early By", "Duration", "Location"]; // Header column names
            filteredData.unshift(header); // Add the header row to the filtered data array
    
            doc.autoTable({
                
                body: filteredData,
                startY: y + 30, // Adjusted the start y-position to create a gap between the text and table
                theme: 'grid',
                fontSize: 6,
        
                didParseCell: function (data) {
                    
                    if (data.row.index === 0) {
                      
                        data.cell.styles.fontStyle = 'bold';
                        data.cell.styles.halign = 'center';
                        data.cell.styles.fillColor = '#D3D3D3';
                        data.cell.styles.fontSize = 8;
                    
                    } // if ends here
                
                }, // function ends here
    
                columnStyles: {
                    
                    fontStyle: 'bold'
                  
                }, // end of columnStyles
    
                styles: {
                    
                  minCellHeight: 15
                  
                }, // end of styles
            
            }); // end of doc.autoTable

          doc.save('Detailed_employee_attendance.pdf'); // Save the report in PDF format
         
        }); // end of jspdf.plugin.autotable.min.js
        
      }); // end of jspdf.min.js

    } // function ends here

    // Check if any filter is applied or not & download the table accordingly in PDF format
    
    function checkAndDownloadInPDF() {
        
        var table_length = document.getElementById('attendance_history_table_length').innerText;
        
        if(table_length === "All"){
            
            exportToPDF() // Call the function to download the table without filter
            
        } // if ends here
            
        else {
            
            exportToPDFWithFilters() // Call the function to download the table with any sort of filter.
            
            // exportToPDF() // Call the function to download the table without filter
            
        } // else ends here
        
    } // function ends here
    
    // Switiching between downloading options

    function changeFunc() {
        
        var selectBox = document.getElementById("selectBox");
        var selectedValue = selectBox.options[selectBox.selectedIndex].value;
        
        if(selectedValue=="checkAndDownloadInExcel"){
            
          checkAndDownloadInExcel(); // calling the funtion to download the report in excel format
          
        } // else ends here
        
        else if(selectedValue=="downloadCSV"){
            
            downloadCSV(); // calling the funtion to download the report in csv format
            
        } // else ends here
        
        else if(selectedValue=="checkAndDownloadInPDF"){
            
            checkAndDownloadInPDF(); // calling the funtion to download the report in pdf format
            
        } // else ends here
        
    } // function ends here
    
    // Download Monthly Attendance Table

    function changeFunc_one() {

        var selectBoxOne = document.getElementById("selectBox_one");
        var selectedValueOne = selectBoxOne.options[selectBoxOne.selectedIndex].value;

        if(selectedValueOne=="exportToExcel_one"){
            
          exportToExcel_one(); // calling the funtion to download the report in excel format
          
        } // else ends here
        
        else if(selectedValueOne=="downloadCSV_one"){
            
            downloadCSV_one(); // calling the funtion to download the report in csv format
            
        } // else ends here
        
        else if(selectedValueOne=="exportToPDF_one"){
            
            exportToPDF_one(); // calling the funtion to download the report in pdf format
            
        } // else ends here
        
    } // function ends here
    
    // Download in PDF for monthly attendance table - version One
    
    // function exportToPDF_one(){
    
        // $.getScript("https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js",()=>{ // calling the cdn for jsPDF
        // $.getScript("https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.6/jspdf.plugin.autotable.min.js",()=>{ // calling the cdn for autotable
        
        // var doc = new jsPDF('L', 'pt', 'letter');  
        // var htmlstring = '';  
        // var tempVarToCheckPageHeight = 0;  
        // var pageHeight = 0;  
        // // pageHeight = doc.internal.pageSize.height; 
        // pageHeight = 2000; 
        
        // specialElementHandlers = {  
            
        //     '#bypassme': function(element, renderer) {  
        
        //         return true  
                
        //     } // function ends here
            
        // }; // Special Element Handler ends here
        
        // margins = {  
            
        //     top: 150,
        //     width: 1500 
            
        // };  // Margin ends here
        
        // var y = 20;  
        // doc.setLineWidth(0.5);  
        // doc.text(280, y = y + 20, "Monthly Employee Attendance");
        
        // doc.autoTable({  
            
        //     html: '#monthly_attendance_table',  
        //     startY: 70,  
        //     // theme: 'grid',
        //     fontSize: 6,
        //     columnStyles: {
                
        //         cellWidth: 50, // set the cell width
                
        //         }, // column style ends here
                
        //     styles: {  
                
        //         minCellHeight: 15  // set the minimum cell height
                
        //     }  // styles end here
            
        // })  // doc.autotable ends here
        
        // doc.save('monthly_employee_attendance.pdf'); // Save the report in pdf format
        
        // }); // end of jspdf.min.js
        // }); // jspdf.plugin.autotable.min.js
        
    // } // function ends here

    // Download in PDF for monthly attendance table - version Two
        
    function exportToPDF_one(){
        
        var month_value = document.getElementById('monthlyattendance').value
        
        var current_month_val = moment().format('MMMM YYYY');
        
        // Check if the month is current month or not
        
        if(month_value == 0){
            
            month_value = current_month_val;
            
        } else {
            
            month_value = moment(month_value).format("MMMM YYYY");
    
        } // else ends here
         
        $.getScript("https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js",()=>{ // calling the cdn for jsPDF
        $.getScript("https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.6/jspdf.plugin.autotable.min.js",()=>{ // calling the cdn for autotable
        
        var doc = new jsPDF('L', 'pt', 'legal');  
        var htmlstring = '';  
        var tempVarToCheckPageHeight = 0;  
        var pageHeight = 0;  
        pageHeight = doc.internal.pageSize.height; 
        pageHeight = 2000; 
        
        specialElementHandlers = {  
            
            '#bypassme': function(element, renderer) {  
        
                return true  
                
            } // function ends here
            
        }; // Special Element Handler ends here
        
        margins = {  
            
            top: 150,
            width: 1000 
            
        };  // Margin ends here
        
        var y = 20;  var x= 1800;
        doc.setLineWidth(0.5);
        
        // Addition the first page heading
        
        doc.setFontSize(14);
        doc.text(360, y = y + 20, "Attendance Summary Report for " + month_value);

        // Addition the second page heading
        
        doc.setFontSize(12);
        doc.text(435, y = y + 20, "Company : GewinnsHR");
        
        doc.autoTable({  
            
            html: '#monthly_attendance_table',  
            startY: 70,
            theme: 'plain',
            fontSize: 6,

            didParseCell: function (data) {
                
                data.cell.styles.lineColor = [0, 0, 0];  // Set border color
                data.cell.styles.lineWidth = 0.1;        // Set the border width
                
                var row = data.row.index;
                var column = data.column.index;
            
                // Check if it's a heading cell
            
                    // if (
                        
                    //     column === 0  && row === 0 || column === 1  && row === 0  || column === 2  && row === 0 || column === 3   && row === 0 ||
                    //     column === 4  && row === 0 || column === 5  && row === 0  || column === 6  && row === 0 || column === 7   && row === 0 ||
                    //     column === 8  && row === 0 || column === 9  && row === 0  || column === 10 && row === 0 || column === 11  && row === 0 ||
                    //     column === 12 && row === 0 || column === 13 && row === 0  || column === 14 && row === 0 || column === 15  && row === 0 ||
                    //     column === 16 && row === 0 || column === 17 && row === 0  || column === 18 && row === 0 || column === 19  && row === 0 ||
                    //     column === 20 && row === 0 || column === 21 && row === 0  || column === 22 && row === 0 || column === 23  && row === 0 || 
                    //     column === 24 && row === 0 || column === 25 && row === 0  || column === 26 && row === 0 || column === 27  && row === 0 || 
                    //     column === 28 && row === 0 || column === 29 && row === 0  || column === 30 && row === 0 || column === 31  && row === 0 || 
                    //     column === 32 && row === 0 || column === 33 && row === 0  || column === 34 && row === 0 || column === 35  && row === 0 || 
                    //     column === 36 && row === 0 || column === 37 && row === 0  || column === 38 && row === 0
                        
                    // ) {
                    
                    //     // Set background color for the heading cells
                      
                    //         data.cell.styles.fillColor = '#D3D3D3';
                            
                    // } // if ends here
                    
                    if (row < 1) {
                
                        data.cell.styles.fillColor = '#D3D3D3';
                    
                } // if ends here
            
            }, // didParseCell ends here
            
            columnStyles: {
            
                0: { cellWidth: 50 },
                1: { cellWidth: 85 },
                2: { cellWidth: 20 },3: { cellWidth: 20 },4: { cellWidth: 20 },5: { cellWidth: 20 },6: { cellWidth: 20 },7: { cellWidth: 20 },8: { cellWidth: 20 },
                9: { cellWidth: 20 },10: { cellWidth: 20 },11: { cellWidth: 20 },12: { cellWidth: 20 },13: { cellWidth: 20 },14: { cellWidth: 20 },
                15: { cellWidth: 20 },16: { cellWidth: 20 },17: { cellWidth: 20 },18: { cellWidth: 20 },19: { cellWidth: 20 },20: { cellWidth: 20 },
                21: { cellWidth: 20 },22: { cellWidth: 20 },23: { cellWidth: 20 },24: { cellWidth: 20 },25: { cellWidth: 20 },26: { cellWidth: 20 },
                27: { cellWidth: 20 },28: { cellWidth: 20 },29: { cellWidth: 20 },30: { cellWidth: 20 },31: { cellWidth: 20 },32: { cellWidth: 20 },
                33: { cellWidth: 20 },34: { cellWidth: 20 },35: { cellWidth: 20 },36: { cellWidth: 20 },37: { cellWidth: 20 },38: { cellWidth: 20 },
                
            }, // column style ends here
                
            styles: {  
                
                minCellHeight: 10,  // set the minimum cell height
            
            },  // styles end here
            
        })  // doc.autotable ends here
        
        // Add a footer to each page
        
        var pageCount = doc.internal.getNumberOfPages();
        
        var currentD = moment().format("DD/MM/YYYY hh:mm:ss a")
        
        for (var i = 1; i <= pageCount; i++) {
            
            doc.setPage(i);
            
            var footerText = "Report Generated on : " + currentD;
            
            // var textX = 30;                                       // left Aligned
            // var textY = doc.internal.pageSize.getHeight() - 35;   // 35 pixels from the bottom
        
            var textWidth = doc.getStringUnitWidth(footerText) * doc.internal.getFontSize();
        
            var textX = doc.internal.pageSize.getWidth() - textWidth - 20; // Aligned to the right margin with a 20-pixel padding
        
            var textY = doc.internal.pageSize.getHeight() - 35; // 35 pixels from the bottom
        
            doc.setFontSize(10);
        
            doc.text(footerText, textX, textY);
            
        } // for loop ends here
        
        // Add outline border to the entire document
        
            var pageCount = doc.internal.getNumberOfPages();
            
            for (var i = 0; i < pageCount; i++) {
                
                doc.setPage(i);
                
                doc.rect(20, 20, doc.internal.pageSize.getWidth() - 40, doc.internal.pageSize.getHeight() - 40, 'S');
                
            } // for loop ends here

        doc.save('attendance_summary_report.pdf'); // Save the report in pdf format
    
        }); // end of jspdf.min.js
        }); // jspdf.plugin.autotable.min.js
        
    } // function ends here
    
    //  Download in Excel for monthly attendance table

    function exportToExcel_one() {
        
        // createNewTable_one() // calling the function to generate a new table
        
        var table = document.getElementById("monthly_attendance_table");
        var workbook = XLSX.utils.table_to_book(table, {sheet:"Sheet 1"});
        var excelBuffer = XLSX.write(workbook, {bookType:'xlsx', type:'array'});
        saveAsExcel_one(excelBuffer, "attendance_summary_report.xlsx");
        
    } // function ends here

    function saveAsExcel_one(buffer, filename) {
        
        var blob = new Blob([buffer], {type: 'application/octet-stream'});
        var url = window.URL.createObjectURL(blob);
        var link = document.createElement('a');
        link.href = url;
        link.setAttribute('download', filename);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
    } // function ends here
    
    //  Download in CSV

    function downloadCSV_one() {
        
        // Get the table data
        
        var tableOne = document.querySelector('table[id="monthly_attendance_table"]');
        
        // console.log(document.querySelectorAll('table')[0]);
        
        const rows = tableOne.querySelectorAll('tr');

        // Build the CSV data
        
        let csv = '';
        
        for (let i = 0; i < rows.length; i++) {
            
            var cells = rows[i].querySelectorAll('td');
            
            if (cells.length===0){
                
                cells = rows[i].querySelectorAll('th');
                
            } // if ends here
        
          let row = '';
          
            if (rows[i].style.display!="none"){
              
                for (let j = 0; j < cells.length; j++) {
                  
                    row += cells[j].textContent.replaceAll(",","|") + ',';
                
                } // for loop ends here
            
            csv += row + '\r\n';
          
            } // if ends here
          
        } // for loop ends here

        // Download the CSV file
        
        const link = document.createElement('a');
        link.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv));
        link.setAttribute('download', 'attendance_summary_report.csv');
        link.click();
        
    } // function ends here
    
    //  Breadcrumbs for Attendance Summary Report"
     
    function bdfun(){
        
        document.getElementById("bd").innerHTML="Attendance Summary Report";
        var firstDayOfCurrentMonth = moment().startOf('month').format('YYYY-MM-DD');
        
        // var curmonth = moment().format("MMM");
        // var curmonthUpdated = curmonth.toUpperCase();
        // var curyear = moment().format("YYYY");
        // document.getElementById("selectMonth").innerHTML = curmonthUpdated + " " +curyear;
        
        // var empArray=[];
        // var url=`/api/resource/Employee/?filters=[["status","=","Active"]]&fields=["employee"]&limit_page_length=None`;
        // fetch(url).then((r)=>r.json()).then((js)=>{//console.log(js);
        
        //     for (var q=0; q<js.data.length; q++){
    
        //         empArray.push(js.data[q].employee);
                
        //     } // for loop ends here
            
        // }); // fetch url ends here
    
        showMonthlyAttendance(firstDayOfCurrentMonth);
        
        // showEmployeeWise("All")
        
    } // function ends here
    
    //  Breadcrumbs for Attendance Details Report"
    
    function bdfun1(){
        
        document.getElementById("bd").innerHTML="Attendance Details Report";
        showDataOnTabChange();
        
        var searchMt = document.getElementById("attendance_history_table_filter");     // Deletion of Search Filter 
        searchMt.parentNode.removeChild(searchMt);
        
        var lengthMt = document.getElementById("attendance_history_table_length");     // Deletion of Pagination Part 01        
        lengthMt.parentNode.removeChild(lengthMt);
        
    } // function ends here
    
    // Breadcrumbs for Daily Production Report"
    
    function bdfun2(){
        
        document.getElementById("bd").innerHTML="Daily Production Report";
        var firstDayOfRecentMonth = moment().startOf('month').format('YYYY-MM-DD');
        showMonthlyAttendance_one(firstDayOfRecentMonth)
        
    } // function ends here
    
    //  Display of all employees for Attendance Summary Report
    
    frappe.ready(() => {
        
        var url=`/api/resource/Employee/?filters=[["status","=","Active"]]&fields=["employee","employee_name"]&limit_page_length=None`;

        fetch(url).then((r)=>r.json()).then((js)=>{//console.log(js);
            
        var dlist = document.getElementById('searchEmployee');
        
            for (var i=0; i<js.data.length;i++){
                
                var item=js.data[i];
                var el = document.createElement("option");
                el.setAttribute("value",item.employee);
                el.innerHTML = item.employee_name;
                dlist.appendChild(el);
                
            } // for loop ends here
        }); // fetch url ends here
    }); // frappe.ready ends here
    
    // Show Employee wise Monthly Attendance Report
    
    var empWiseBlank; 
    var month;
    
    function showEmployeeWise(empwise){
        
        empWiseBlank = empwise
        var firstDayOfRecentMonth = moment().startOf('month').format('YYYY-MM-DD');
        
        var selectBox = document.getElementById("monthlyattendance");
        var selectedValue = selectBox.options[selectBox.selectedIndex].value;
        
        // Display of data for any employee with no month selected
            
        if (empWiseBlank != 'All' && selectedValue.length === 0){

            showMonthlyAttendanceWithEmployeeFilter(firstDayOfRecentMonth,empWiseBlank)
            
        } // if ends here
        
        // Display of data for all employees with no month selected
        
        else if(empWiseBlank === 'All' && selectedValue.length === 0){
            
            showMonthlyAttendance(firstDayOfRecentMonth)
            
        } // else if ends here
        
        // Display of data for any employee with any month selected
            
        else if (empWiseBlank != 'All' && selectedValue.length > 0){
            
            showMonthlyAttendanceWithEmployeeFilter(selectedValue,empWiseBlank)
            
        } // else if ends here
        
        // Display of data for All employees with any month selected
            
        else if (empWiseBlank === 'All' && selectedValue.length > 0){
            
            showMonthlyAttendance(selectedValue);
            
        } // else if ends here
        
    } // function ends here

    // Show Month wise Monthly Attendance Report
    
    function ShowDataEmployeeWiswAndMonthlyWise(month) {
        
        var selectBox_one = document.getElementById("searchEmployee");
        var selectedValue_one = selectBox_one.options[selectBox_one.selectedIndex].value;
        month = month;
        var firstDayOfRecentMonth = moment().startOf('month').format('YYYY-MM-DD');
    
        // Display of data for All employees with any month selected
            
        if (selectedValue_one.length === 0 && month.length > 0){
            
            showMonthlyAttendance(month)
            
        } // if ends here
      
        // Display of data for any employee with any month selected
            
        else if (selectedValue_one != 'All' && month.length > 0){
            
            showMonthlyAttendanceWithEmployeeFilter(month,selectedValue_one);
            
        } // else if ends here
        
        // Display of data for All employees with any month selected
            
        else if (selectedValue_one === 'All' && month.length > 0){
            
            showMonthlyAttendance(month)
            
        } // else if ends here
        
    } // function ends here
    
    // Applying filter to the employee data for Monthly Attendance Report

    function showMonthlyAttendanceWithEmployeeFilter(val,emp){

        document.getElementById("attendance_history_table_wrapper").style.display="none";
        document.getElementById("monthlyattendancediv").style.display="block";
        document.getElementById("abbr").style.display="flex";
        document.getElementById("abbr_one").style.display="flex";
        
        var mtable=document.getElementById("monthly_attendance_table");
        mtable.innerHTML=" ";
        var thead=document.createElement("thead");
        var date=moment(val,"YYYY-MM-DD");
        var totdays=date.daysInMonth();
        var etr1=document.createElement("tr");
        var etr2=document.createElement("tr"); 
        
        var th=document.createElement("th");
        // th.rowSpan = '2';
        th.setAttribute('class','text-center align-middle');
        th.innerHTML="ID";
        etr1.appendChild(th);
        
        var th=document.createElement("th");
        th.innerHTML="";
        etr2.appendChild(th);
         
        var th=document.createElement("th");
        // th.rowSpan = '2';
        th.setAttribute('class','text-center align-middle');
        th.innerHTML="Name";
        etr1.appendChild(th);
        
        var th=document.createElement("th");
        th.innerHTML="";
        etr2.appendChild(th);
        
        for (var i=1; i<=totdays;i++){
    
            var dayname=date.format('dddd').substring(0,2);
            var eth=document.createElement("th");
            eth.innerHTML=dayname;
            etr1.appendChild(eth);
            var eth1=document.createElement("th");
            eth1.innerHTML="D"+i;
            // eth1.innerHTML=i;
            etr2.appendChild(eth1);
            date=date.add(1, 'days');
            
        } // adding header value ends
        
        var th=document.createElement("th");th.innerHTML="PD";
        th.rowSpan = '2';
        th.setAttribute('class','text-center align-middle');
        etr1.appendChild(th);
        // th=document.createElement("th");etr2.appendChild(th);
        
        var th=document.createElement("th");th.innerHTML="HD";
        th.rowSpan = '2';
        th.setAttribute('class','text-center align-middle');
        etr1.appendChild(th);
        
        th=document.createElement("th");th.innerHTML="TH";
        th.rowSpan = '2';
        th.setAttribute('class','text-center align-middle');
        etr1.appendChild(th);
        
        th=document.createElement("th");th.innerHTML="AD";
        th.rowSpan = '2';
        th.setAttribute('class','text-center align-middle');
        etr1.appendChild(th);
        // th=document.createElement("th");etr2.appendChild(th);
        
        th=document.createElement("th");th.innerHTML="TL";
        th.rowSpan = '2';
        th.setAttribute('class','text-center align-middle');
        etr1.appendChild(th);
        // th=document.createElement("th");etr2.appendChild(th);
        
        th=document.createElement("th");th.innerHTML="TD";
        th.rowSpan = '2';
        th.setAttribute('class','text-center align-middle');
        etr1.appendChild(th);
        // th=document.createElement("th");etr2.appendChild(th);
        
        //etr1.insertAdjacentHTML(beforeend,"<th>TOT</th>");
        
        thead.appendChild(etr1); 
        thead.appendChild(etr2);
        mtable.appendChild(thead);
        
        var tbody=document.createElement("tbody");
        var fromdate=moment(val,"YYYY-MM-DD");
        var todate=fromdate.clone().add(totdays-1,'days');
        //console.log(fromdate.format("YYYY-MM-DD"));console.log(todate.format("YYYY-MM-DD"));
       
        frappe.call({method:'attendance_monthly_report_updated',
        
            args : {fromdate:fromdate.format("YYYY-MM-DD"),todate:todate.format("YYYY-MM-DD"),employee:emp},
            
            callback : (res)=>{
                
                // console.log(res);
                
                var encodedEmp = encodeURIComponent(emp);
                
                var url=`/api/resource/Employee/?filters=[["status","=","Active"],["employee","=","${encodedEmp}"]]&fields=["employee","employee_name","department","company","default_shift","holiday_list","date_of_joining"]&limit_page_length=None`;
                
                // console.log(url);res.message.woffs[0].weekly_off
                
                var woff=res.message.woffs[0].weekly_off;
        
            fetch(url).then((r)=>r.json()).then((js)=>{// console.log(js);
               
                for (var j=0; j<js.data.length;j++){    // Get the employee related information
            
                    // doj=moment(js.data[j].date_of_joining,"YYYY-MM-DD");
                    
                    var etrb1=document.createElement("tr");
                    etrb1.setAttribute('class','trdata');
                    
                    var etdname=document.createElement("td");
                    etdname.setAttribute('class','tddata');
                    
                    etdname.innerHTML=js.data[j].employee;
                    // console.log(js.data[j].date_of_joining);
                    etdname.setAttribute("id",`${j}0`);
                    etrb1.appendChild(etdname);
                    
                    var etdname=document.createElement("td");
                    etdname.innerHTML=js.data[j].employee_name;
                    // console.log(js.data[j].date_of_joining);
                    etdname.setAttribute("id",`${j}0`);
                    etrb1.appendChild(etdname);
        
                    for (var k=1; k<=totdays;k++){
                        
                        var etd=document.createElement("td");
                        //etd.innerHTML=k;
                        //console.log(fromdate.clone().add(k,'days').format("dddd"));
                        if(fromdate.clone().add(k-1,'days').format("dddd")==woff){
                            
                            //console.log(fromdate.clone().add(k,'days').format("dddd"));
                            etd.innerHTML="WO";
                            
                        } // if ends here
                        
                        else {
                            
                            etd.innerHTML="";
                            
                        } // else ends here
                        //etd.setAttribute("id",`${j}${k}`);etrb1.appendChild(etd);
                        etd.setAttribute("id",`e${j}d${k}`);
                        etd.setAttribute("class",`text-center`);
                        etrb1.appendChild(etd);
                        
                    } // for loop ends here
                    
                    var td=document.createElement("td");td.setAttribute('class',`text-center`);td.setAttribute('id','pd'+j);etrb1.appendChild(td);
                    td=document.createElement("td");td.setAttribute('class',`text-center`);td.setAttribute('id','hdp'+j);etrb1.appendChild(td);
                    td=document.createElement("td");td.setAttribute('class',`text-center`);td.setAttribute('id','th'+j);etrb1.appendChild(td);
                    
                    td=document.createElement("td");td.setAttribute('class',`text-center`);td.setAttribute('id','ad'+j);etrb1.appendChild(td);
                    td=document.createElement("td");td.setAttribute('class',`text-center`);td.setAttribute('id','tl'+j);etrb1.appendChild(td);
                    td=document.createElement("td");td.setAttribute('class',`text-center`);td.setAttribute('id','td'+j);etrb1.appendChild(td);
                    
                    tbody.appendChild(etrb1);
                        
                } // end for j
                
                    mtable.appendChild(tbody);
                    var wday=moment(res.message.attendance[0].WorkDate,"YYYY-MM-DD");
                    
                    // This loop is used to decide fromdate and todate for getting leave balance
                    
                    var day=wday.date(); var from_date;var to_date;
                    
                    for (var w=0; w<res.message.woffs.length;w++){
                        
                        from_date=moment(res.message.woffs[w].from_date,"YYYY-MM-DD");
                        to_date=moment(res.message.woffs[w].to_date,"YYYY-MM-DD");
                        
                        if (from_date.diff(wday,"days")<=0 && to_date.diff(wday,"days")>0){
                            
                            break;
                        
                        } // if ends here
                        
                    } // for loop ends here
                    
                    for (j=0;j<js.data.length;j++){
                        
                        var doj=moment(js.data[j].date_of_joining,"YYYY-MM-DD");
                        var company=js.data[j].company;
                        var shift=js.data[j].default_shift;
                        var countp=0;var countlwp=0;var counta=0; var countwop=0; var countpl=0;
                        var countwopl=0;
                        var countal=0;var countwoal=0;
                        //this loop is used for placing employee attendance record
                        
                        for (var l=0;l<res.message.attendance.length;l++){
                            
                            wday=moment(res.message.attendance[l].WorkDate,"YYYY-MM-DD");
                            day=wday.date();
                            
                            if (js.data[j].employee==res.message.attendance[l].Employee){
                                
                                var el=document.getElementById(`e${j}d${day}`);
                                // el.setAttribute("class",`text-center`);
                                var btn=document.createElement("button");
                                var ol=el.innerHTML;
                             
                                if(res.message.attendance[l].Status=="P"){
                                    
                                    if(ol.trim().length==0){
                                       
                                        el.innerHTML= el.innerHTML+"<span class='text-dark'>"+res.message.attendance[l].Status+"</span>";
                                        
                                    } // if ends here
                                    
                                    else{
                                        
                                        el.innerHTML= el.innerHTML +"/"+"<span class='text-dark'>"+res.message.attendance[l].Status+"</span>";
                                        
                                    } // else ends here 
                                    
                                } // if ends here
        
                                else if(res.message.attendance[l].Status=="A"){
                                    
                                    if(ol.trim().length==0){
                                       
                                        el.innerHTML= el.innerHTML+"<span class='text-danger'>"+res.message.attendance[l].Status+"</span>";
                                        
                                    } // if ends here
                                    
                                    else{
                                        
                                        el.innerHTML= el.innerHTML +"/"+"<span class='text-danger'>"+res.message.attendance[l].Status+"</span>";
                                        
                                    } // else ends here 
                                    countlwp+=1;
                                    
                                } // else if ends here
        
                                else {
                                
                                    if(ol.trim().length==0){
                                        
                                        el.innerHTML= el.innerHTML+res.message.attendance[l].Status;
                                        
                                    } else {
                                        
                                        el.innerHTML= el.innerHTML +"/"+res.message.attendance[l].Status;
                                        
                                    } // else ends here
                                    
                                } // else ends here
                                
                                var att=JSON.stringify(res.message.attendance[l]);
                                //var start=moment(res.message.woffs[0].from_date,"YYYY-MM-DD");
                                el.setAttribute("onclick","showDetails('"+att+"','"+company+"','"+shift+"','"+from_date.format("YYYY-MM-DD")+"','"+to_date.format("YYYY-MM-DD")+"')");
                            }//end if
                        }//end for l
                        //this loop is used for placing employee leave record
                        for (var m=0;m<res.message.leaves.length;m++){
                            
                            if (js.data[j].employee==res.message.leaves[m].employee){
                                
                                for (var d=moment(res.message.leaves[m].from_date,"YYYY-MM-DD");d<=moment(res.message.leaves[m].to_date,"YYYY-MM-DD");d.add(1,"days")){
                                    
                                    var lday=d.date();
                                    var el1=document.getElementById(`e${j}d${lday}`);
                                    // el1.setAttribute("class",`text-center`);
                                    var sl=el1.innerHTML;
                                    // console.log(sl.length);
                                    if(sl.length==0) {
                                        
                                        if (res.message.leaves[m].status==="Approved"){el1.innerHTML=el1.innerHTML+"L";}
                                        else if (res.message.leaves[m].status==="Open"){el1.innerHTML=el1.innerHTML+"O";}
                                        else if (res.message.leaves[m].status==="Rejected"){el1.innerHTML=el1.innerHTML+"R";}
                                        else if (res.message.leaves[m].status==="Cancelled"){el1.innerHTML=el1.innerHTML+"C";} 
                                        
                                    } // if ends here
                                    
                                    else {
                                        
                                        if (res.message.leaves[m].status==="Approved"){el1.innerHTML=el1.innerHTML+"/"+"L";}
                                        else if (res.message.leaves[m].status==="Open"){el1.innerHTML=el1.innerHTML+"/"+"O";}
                                        else if (res.message.leaves[m].status==="Rejected"){el1.innerHTML=el1.innerHTML+"/"+"R";}
                                        else if (res.message.leaves[m].status==="Cancelled"){el1.innerHTML=el1.innerHTML+"/"+"C";}
                                        
                                    } // else ends here
                                    
                                    if (res.message.leaves[m].leave_type==="Leave Without Pay") {
                                        
                                        countlwp+=1;
                                        
                                    } // if ends here
                                    
                                } // for loop ends here
                            } // if ends here
                        }//end for m
                        //use res.message.holidays
                        for ( m=0;m<res.message.holidays.length;m++){
                            
                            var d1=moment(res.message.holidays[m].holiday_date,"YYYY-MM-DD");
                            var hday=d1.date();
                            var el2=document.getElementById(`e${j}d${hday}`);
                            // el2.setAttribute("class",`text-center`);
                            el2.innerHTML="H";
                            
                        }//end for m
                        
                        //filling the remaining field with A
                        
                        for (var k=1; k<=totdays;k++){
                            
                            var etd=document.getElementById(`e${j}d${k}`);
                            etd.setAttribute("class",`text-center`);//etd.innerHTML=k;js.data[j].employee
                            var d2=date.format("YYYY-")+ date.month() + `-${k}`;
                            // console.log(moment().diff(moment(d2,"YYYY-MM-DD")));
                            var att=`{"Employee":"${js.data[j].employee}","EmployeeName":"${js.data[j].employee_name}","WorkDate":"${d2}","FirstIn":"00:00:00","LastOut":"00:00:00","LateIn":"0","EarlyOut":"0","duration":""}`;
                                
                            if (etd.innerHTML==""){

                                //to take care that filling date is more than doj
                                
                                    if((moment(d2,"YYYY-MM-DD").diff(doj))>=0){
                                       
                                      if(moment().diff(moment(d2,"YYYY-MM-DD"))>0) {
                                           
                                            etd.setAttribute("class","text-danger text-center");
                                            etd.innerHTML="A";
                                            etd.setAttribute("onclick","showDetails('"+att+"','"+company+"','"+shift+"','"+from_date.format("YYYY-MM-DD")+"','"+to_date.format("YYYY-MM-DD")+"')");
                                            
                                        } // if ends here 
    
                            } // if ends here
                            } // if ends here
                            //etd.setAttribute("id",`${j}${k}`);//etrb1.appendChild(etd);
                        }//end for k
                        
                        
                        for (var k=1; k<=totdays;k++){
                            
                            var etdc=document.getElementById(`e${j}d${k}`);
                            //console.log(etdc.innerHTML);
                            if (etdc.innerHTML=="A"){
                                
                                countlwp+=1;
                                
                            } // if ends here
                            
                            else if (etdc.innerHTML=="P/L"){
                                
                                countpl+=1;
                                
                            } // if ends here
                        
                        } // for loop ends here
                        //   total days  
                    
                        var twdays=totdays;
                        // console.log(js.data[j].employee,doj,totdays,moment(d2,"YYYY-MM-DD").diff(doj,'days'));
                        // console.log(moment(d2,"YYYY-MM-DD").diff(doj,'days'))
                        if (moment(d2,"YYYY-MM-DD").diff(doj,'days')<totdays){
                            
                            twdays=moment(d2,"YYYY-MM-DD").diff(doj,'days')+1;
                            // console.log(twdays,doj,d2);
                            if(twdays<0){
                                twdays=0;
                            }
                            else{
                                twdays=twdays;
                            }
                            
                        } // if ends here
                        
                        // present days
                        
                        var countp=0;
                        for (var p=0;p<res.message.attendance_one.length;p++){
                            var citem=res.message.attendance_one[p];
                            if(js.data[j].employee==citem.Employee){
                                
                                 countp=citem.No_of_Present_Days;
                                 
                            } // if ends here
                        } // for loop ends here
                        
                        // present days
                        
                        var counthdp=0;
                        for (var h=0;h<res.message.attendance_two.length;h++){
                            var ditem=res.message.attendance_two[h];
                            if(js.data[j].employee==ditem.Employee){
                                
                                 counthdp=ditem.No_of_Present_Days;
                                 
                            } // if ends here
                        } // for loop ends here
                        
                        // count weekly off 
                        
                        var countwo=0;
                        for (var k=1; k<=totdays;k++){
                            
                            var rd = fromdate.clone().add(k-1,'days');
                            var difference = rd.diff(doj,"days");
                            if(rd.format("dddd")==woff){
                                
                                if(difference>=0){
                                    
                                    countwo+=1;
                                    
                                } // if ends here
                            } // if ends here
                        } // for loop ends here
                        
                        // count national holiday
                        
                        var counth=0; var holiday=0;
                        for (var s=1; s<=totdays;s++){
                            
                            var rd_ho = fromdate.clone().add(s-1,'days');
                            var difference_ho = rd_ho.diff(doj,"days");
                            for (var m=0;m<res.message.holidays.length;m++){
                                
                                if(rd_ho.format("YYYY-MM-DD")==(res.message.holidays[m].holiday_date)){
                                    
                                    if(difference_ho>=0){
                                        
                                        // alert("chinchu");
                                        counth+=1;
                                        
                                    } // if ends here
                                } // if ends here
                            } // for loop ends here
                        } // for loop ends here
                        
                        holiday=(counth-countwo);
                        
                        if (holiday<0){
                            
                          holiday=0; 
                           
                        } // if ends here
                        
                        else{
                            
                            holiday=holiday;
                            
                        } // else ends here
                        
                        // count leave
                        
                        var countal=0;
                        for (var m=0;m<res.message.leaves.length;m++){
                            
                            if (js.data[j].employee==res.message.leaves[m].employee){
                                
                                if (res.message.leaves[m].status==="Approved"){
                                    
                                        countal+=1;
                                     
                                } // if ends here
                            } // if ends here
                        } // end for m
                        
                        $(`#pd${j}`).html(countp);
                        $(`#hdp${j}`).html(counthdp);
                        $(`#th${j}`).html(countwo+holiday-(countwop+countwopl+countwoal));
                        $(`#ad${j}`).html(countlwp);
                        $(`#tl${j}`).html(countal);
                        $(`#td${j}`).html(twdays);
                      
                    } // end for j
                    
            });//end for employee fetch 
        }//end for callback res
        });//end for monthly attendance fetch
    
    } // function ends here

    // Display of attendance data for a specified date range

    function getAttendance(){
    
        attendance(moment($(".datepicker-here")[0].value,"DD/MM/YYYY").format("YYYY-MM-DD"),moment($(".datepicker-here")[1].value,"DD/MM/YYYY").format("YYYY-MM-DD"));

        var search = document.getElementById("attendance_history_table_filter");     // Deletion of Search Filter 
        search.parentNode.removeChild(search);
        
        var length = document.getElementById("attendance_history_table_length");     // Deletion of Pagination Part 01        
        length.parentNode.removeChild(length);
        
    } // function ends here
    
    // Display of Data with Date Range

    var dtable=null;

    function attendance(d1,d2){
        
        document.getElementById("monthlyattendancediv").style.display="none";
        
        if (dtable!==null){
            
            dtable.destroy();  // Destroying the data table
            
        } // if ends here
    
        frappe.call({method:'detailed_employee_attendance_report',
        
            args: {fromdate:d1, todate :d2 },
            
            callback : function(res){

            var tbody = document.getElementById("attendance_history");
            tbody.innerHTML=" ";
            
            var url=`/api/resource/Employee/?filters=[["status","=","Active"]]&fields=["employee","employee_name"]&limit_page_length=None`;

            fetch(url).then((r)=>r.json()).then((js)=>{//console.log(js);
        
            for(var j=0;j<js.data.length;j++){
                
                for (var i=0; i<res.message.length;i++){
                    
                    var item=res.message[i];
                    
                    if(js.data[j].employee==item.Employee){
                    
                        var row = tbody.insertRow();
                        
                        var cell0=row.insertCell();
                        cell0.innerHTML=moment(item.WorkDate).format("DD/MM/YYYY");
                        cell0.style.textAlign='center';
                        // cell0.style.borderBottom= "thin solid #00ffff"; 
                        cell0.style.fontSize= '12px';
                        
                        var cell1=row.insertCell();
                        cell1.innerHTML=item.Month;
                        cell1.style.textAlign='center';
                        // cell1.style.borderBottom= "thin solid #00ffff";
                        cell1.style.fontSize= '12px';
                        
                        var cell2=row.insertCell();
                        cell2.innerHTML=item.Employee;
                        cell2.style.textAlign='center';
                        // cell2.style.borderBottom= "thin solid #00ffff";
                        cell2.style.fontSize= '12px';
                        
                        var cell3=row.insertCell();
                        cell3.innerHTML=item.EmployeeName;
                        cell3.style.textAlign='center';
                        // cell3.style.borderBottom= "thin solid #00ffff"; 
                        cell3.style.fontSize= '12px';
                        
                        var cell4=row.insertCell();
                        cell4.innerHTML=item.FirstIn;
                        cell4.style.textAlign='center';
                        // cell4.style.borderBottom= "thin solid #00ffff";  
                        cell4.style.fontSize= '12px';
                        
                        var cell5=row.insertCell();
                        cell5.innerHTML=item.LastOut;
                        cell5.style.textAlign='center';
                        // cell5.style.borderBottom= "thin solid #00ffff"; 
                        cell5.style.fontSize= '12px';
                        
                        var cell6=row.insertCell();
                        cell6.innerHTML=item.LateIn;
                        cell6.style.textAlign='center';
                        // cell6.style.borderBottom= "thin solid #00ffff";
                        cell6.style.color="red";
                        cell6.style.fontSize= '12px';
                        
                        var cell7=row.insertCell();
                        cell7.innerHTML=item.EarlyOut;
                        cell7.style.textAlign='center';
                        cell7.style.color="#b3b300";
                        // cell7.style.borderBottom= "thin solid #00ffff";
                        cell7.style.fontSize= '12px';
                        
                        var cell8=row.insertCell();
                        cell8.innerHTML=item.duration;
                        cell8.style.textAlign='center';
                        // cell8.style.borderBottom= "thin solid #00ffff";  
                        cell8.style.fontSize= '12px';
                        
                        var cell9=row.insertCell();
                        cell9.innerHTML=item.Location;
                        // cell9.style.borderBottom= "thin solid #00ffff";  
                        cell9.style.fontSize= '12px';
                        
                    }//if ends here
                }//for loop ends here
                        
            } // for loop ends here
            
        });//fech url ends here    
    
        var a = document.getElementById("attendance_history_table").innerHTML; // Getting the value of Attendance History Table
        var b = document.getElementById("newTable");                           // Getting the value of New Table
        b.innerHTML= a;                                                        // Setting the value of Attendance History Table into New Table
    
        $.getScript("https://cdn.datatables.net/1.13.2/js/jquery.dataTables.min.js",()=>{
        $.getScript("https://cdn.datatables.net/1.13.2/js/dataTables.bootstrap5.min.js",()=>{
        var count = 0;
        $('#attendance_history_table tfoot th').each(function () {
            count ++;
            var title = $(this).text();
            // console.log(title);
            // $(this).html('<input type="text" class="text-center" placeholder=" ' + title + '" />');
            $(this).html('<input type="text" style="width: 100px;" class="search-input text-center" placeholder="Search here" id="filter' + count + '"/>');
        });
        //console.log($('#attendance_history_table'));
        dtable = $('#attendance_history_table').DataTable({
            
            // paging:false,
            //pagination:false,
            iDisplayLength: -1,
            aLengthMenu: [[ 25, 50,100, -1], [ 25, 50,100, "All"]],
            
          "columnDefs": [
               
                {
                  
                    "render": function (data, type, row, meta) {
                    
                    if (meta.col === 9) { // Targeting the last cell
                  
                        return '<div class="scrollable-cell">' + data + '</div>';
                    
                    } // if ends here
                  
                    return data;
                  
                }, // function ends here
                
                "targets": "_all" // Apply the rendering to all columns
                
              }
              
            ], 
            
            initComplete: function () {
                
                // Apply the search
                
                this.api()
                    .columns()
                    .every(function () {
                        var that = this;
                        $('input', this.footer()).on('keyup change clear', function () {
                            
                            if (that.search() !== this.value) {
                                
                                that.search(this.value).draw();
                                
                            } // if ends here
                        });
                    });
                    
                    var info = document.getElementById("attendance_history_table_info");            // Basic styling of pagination part 03
                    info.setAttribute('class','p-t-20 p-b-20 p-l-20 float-left');
                    
                    var paginate = document.getElementById("attendance_history_table_paginate");    // Basic styling of pagination part 02
                    paginate.setAttribute('class','p-t-20 p-b-20');
                    
                    // Hide the text of the pagination dropdown 
                    
                    // Get the div element by its id
                    
                    var divElement = document.getElementById('attendance_history_table_length');
                    
                    // Get the label element inside the div
                    
                    var labelElement = divElement.querySelector('label');
                    
                    // Check if the label element exists
                    
                    if (labelElement) {
                        
                        // Get the select element within the label
                      
                        var selectElement = labelElement.querySelector('select');
                    
                        // Check if the select element exists
                      
                        if (selectElement) {
                          
                            // Iterate over child nodes of the label
                        
                            for (var i = 0; i < labelElement.childNodes.length; i++) {
                            
                                var childNode = labelElement.childNodes[i];
                    
                                // Check if the child node is not the select element
                          
                                if (childNode !== selectElement) {
                              
                                    // Remove the text content of the child node
                            
                                    labelElement.removeChild(childNode);
                                    
                                } // if ends here
                                
                                // Set the height value
                          
                                if (selectElement) {
                            
                                    selectElement.style.height = '38px'; 
                                    
                                } // if ends here
                            
                            } // for loop ends here
                            
                      } // if ends here
                       
                    } // if ends here
                    
                    // Hide the text for the universal search bar
                    
                    // Get the div element by its id
                    
                    var divElementOne = document.getElementById('attendance_history_table_filter');
                    
                    // Get the label element inside the div
                    
                    var labelElement = divElementOne.querySelector('label');
                    
                    // Check if the label element exists
                    
                    if (labelElement) {
                        
                        // Get the input element within the label
                      
                        var inputElement = labelElement.querySelector('input');
                    
                        // Check if the input element exists
                  
                        if (inputElement) {
                      
                            // Clear the text content of the label while preserving the input element
                    
                            labelElement.firstChild.nodeValue = '';
                    
                        } // if ends here
                            
                        // Set the placeholder value
                        
                        if (inputElement) {
                            
                            inputElement.placeholder = 'Search Here';
                          
                        } // if ends here
                        
                        // Set the height value
                        
                        if (inputElement) {
                            
                            inputElement.style.height = '38px'; 
                          
                        } // if ends here

                    } // if ends here
                    
                    // Get the id of the data table pagination
                    
                    var datatablePagination = document.getElementById('datatable_pagination');
                    
                    // Get the id of the data table search bar
                    
                    var datatableSearchBar = document.getElementById('datatable_searchbar');
                    
                    // Append the data table pagination into the main div
                
                    datatablePagination.appendChild(divElement);
                    
                    // Append the data table search bar into the main div
                    
                    datatableSearchBar.appendChild(divElementOne);
            },

        });
        
        // } else { dtable.reload();}
        //console.log(dtable);
        //console.log(dtable.pagination);inputted 
        //console.log(dt);
        });//end of bootstrap
        });//end of datatable
        }// end callback function
        });//end frappe.call
    } // function ends here

    //  Display of all employees for Daily Production Report
    
    frappe.ready(() => {
        
        var url=`/api/resource/Employee/?filters=[["status","=","Active"]]&fields=["employee","employee_name"]&limit_page_length=None`;

        fetch(url).then((r)=>r.json()).then((js)=>{ // console.log(js);
            
            var dlist = document.getElementById('searchEmployee_one');
            
                for (var i=0; i<js.data.length;i++){
                    
                    var item=js.data[i];
                    var el = document.createElement("option");
                    el.setAttribute("value",item.employee);
                    el.innerHTML = item.employee_name;
                    dlist.appendChild(el);
                    
                } // for loop ends here
        }); // fetch url ends here
    }); // frappe.ready ends here

    // Show Employee wise data for Daily Production Report
    
    // var empWiseBlank; 
    // var month;
    
    // function showEmployeeWise_one(empwise){
        
    //     empWiseBlank = empwise
    //     var firstDayOfRecentMonth = moment().startOf('month').format('YYYY-MM-DD');
        
    //     var selectBox_three = document.getElementById("monthlyattendance_one");
    //     var selectedValue_three = selectBox_three.options[selectBox_three.selectedIndex].value;
        
    //     // Display of data for any employee with no month selected
            
    //     if (empWiseBlank != 'All' && selectedValue_three.length === 0){

    //         showMonthlyAttendanceWithEmployeeFilter_one(firstDayOfRecentMonth,empWiseBlank)
            
    //     } // if ends here
        
    //     // Display of data for all employees with no month selected
        
    //     else if(empWiseBlank === 'All' && selectedValue_three.length === 0){
            
    //         showMonthlyAttendance_one(firstDayOfRecentMonth)
            
    //     } // else if ends here
        
    //     // Display of data for any employee with any month selected
            
    //     else if (empWiseBlank != 'All' && selectedValue_three.length > 0){
            
    //         showMonthlyAttendanceWithEmployeeFilter_one(selectedValue,empWiseBlank)
            
    //     } // else if ends here
        
    //     // Display of data for All employees with any month selected
            
    //     else if (empWiseBlank === 'All' && selectedValue_three.length > 0){
            
    //         showMonthlyAttendance_one(selectedValue);
            
    //     } // else if ends here
        
    // } // function ends here

    // Show Month wise data for Daily Production Report
    
    // function ShowDataEmployeeWiswAndMonthlyWise_one(month) {
        
    //     var selectBox_four = document.getElementById("searchEmployee_one");
    //     var selectedValue_four = selectBox_four.options[selectBox_four.selectedIndex].value;
    //     month = month;
    //     var firstDayOfRecentMonth = moment().startOf('month').format('YYYY-MM-DD');
    
    //     // Display of data for All employees with any month selected
            
    //     if (selectedValue_four.length === 0 && month.length > 0){
            
    //         showMonthlyAttendance_one(month)
            
    //     } // if ends here
      
    //     // Display of data for any employee with any month selected
            
    //     else if (selectedValue_four != 'All' && month.length > 0){
            
    //         showMonthlyAttendanceWithEmployeeFilter_one(month,selectedValue_four);
            
    //     } // else if ends here
        
    //     // Display of data for All employees with any month selected
            
    //     else if (selectedValue_four === 'All' && month.length > 0){
            
    //         showMonthlyAttendance_one(month)
            
    //     } // else if ends here
        
    // } // function ends here

    // Display of data of Daily Production Report (on reolad)
    
    // function showMonthlyAttendance_one(val){
        
    //     var mtable=document.getElementById("monthly_attendance_one_table");
    //     mtable.innerHTML=" ";
        
    //     var thead=document.createElement("thead");
    //     var date=moment(val,"YYYY-MM-DD");
    //     var totdays=date.daysInMonth();
        
    //     var etr1=document.createElement("tr"); //el2=document.createElement("th");el2.innerHTML="H";
    //     var etr2=document.createElement("tr");
    //     var etr3=document.createElement("tr");
        
    //     var ethslno1=document.createElement("th");ethslno1.innerHTML="Sl.";etr1.appendChild(ethslno1);
    //     var ethslno1=document.createElement("th");ethslno1.innerHTML=" ";etr3.appendChild(ethslno1);
    //     var ethslno2=document.createElement("th");ethslno2.innerHTML="";etr2.appendChild(ethslno2);
        
    //     th=document.createElement("th");th.innerHTML="ID";etr1.appendChild(th);
    //     th=document.createElement("th");th.innerHTML=" ";etr3.appendChild(th);etr3.setAttribute("class",`text-center`);
    //     th=document.createElement("th");etr2.appendChild(th);
        
    //     var ethname1=document.createElement("th");ethname1.innerHTML="Name";etr1.appendChild(ethname1);
    //     var ethname1=document.createElement("th");ethname1.innerHTML=" ";etr3.appendChild(ethname1);
    //     var ethname2=document.createElement("th");ethname2.innerHTML="";etr2.appendChild(ethname2);
        
    //     th=document.createElement("th");th.innerHTML="Department";th.setAttribute("class",`text-center`);etr1.appendChild(th);
    //     th=document.createElement("th");th.innerHTML=" ";etr3.appendChild(th);etr3.setAttribute("class",`text-center`);
    //     th=document.createElement("th");etr2.appendChild(th);
    
    //     th=document.createElement("th");th.innerHTML="Time";th.setAttribute("class",`text-center`);etr1.appendChild(th);
    //     th=document.createElement("th");th.innerHTML=" ";etr3.appendChild(th);etr3.setAttribute("class",`text-center`);
    //     th=document.createElement("th");etr2.appendChild(th);
        
    //     for (var i=1; i<=totdays;i++){
            
    //         var dayname=date.format('dddd').substring(0,2);
    //         var eth=document.createElement("th");
    //         eth.innerHTML=dayname;etr1.appendChild(eth);
    //         var eth1=document.createElement("th");eth1.innerHTML="D"+i;etr2.appendChild(eth1);
    //         etr1.setAttribute("class",`text-center`);etr2.setAttribute("class",`text-center`);
    //         date=date.add(1, 'days');
            
    //     } // for loop for i ends here
        
    //     th=document.createElement("th");th.innerHTML="Present Days";th.setAttribute("class",`text-center`);etr1.appendChild(th);
    //     th=document.createElement("th");th.innerHTML=" ";etr3.appendChild(th);etr3.setAttribute("class",`text-center`);
    //     th=document.createElement("th");etr2.appendChild(th);
        
    //     thead.appendChild(etr1); 
    //     thead.appendChild(etr2);
    //     thead.appendChild(etr3);
    //     mtable.appendChild(thead);
        
    //     var tbody=document.createElement("tbody");
    //     var fromdate=moment(val,"YYYY-MM-DD");
    //     var todate=fromdate.clone().add(totdays-1,'days');
       
    //     frappe.call({method:'form_d_type_2_report',
        
    //         args : {fromdate:fromdate.format("YYYY-MM-DD"),todate:todate.format("YYYY-MM-DD")},
            
    //             callback : (res)=>{ // console.log(res);
                
    //             var url=`/api/resource/Employee/?filters=[["status","=","Active"]]&fields=["employee","employee_name","department","designation","branch","company","default_shift","holiday_list","date_of_joining"]`;
    
    //             var woff=res.message.woffs[0].weekly_off;
        
    //             fetch(url).then((r)=>r.json()).then((js)=>{
            
    //                 for (var j=0; j<js.data.length;j++){
                    
    //                     var etrb1=document.createElement("tr");

    //                     // Sl No.
                        
    //                     var etdslno=document.createElement("td");
    //                     etdslno.innerHTML=j+1;
    //                     etrb1.appendChild(etdslno);
                        
    //                     // Employee Id
                        
    //                     var etdid=document.createElement("td");
    //                     etdid.innerHTML=js.data[j].employee;
    //                     etdid.setAttribute("id",`${j}0`);
    //                     etrb1.appendChild(etdid);
    //                     etrb1.setAttribute("class","text-center");
                        
    //                     // Employee Name
                        
    //                     var etdname=document.createElement("td");
    //                     etdname.innerHTML=js.data[j].employee_name;
    //                     etdname.setAttribute("class",`text-center`);
    //                     etrb1.appendChild(etdname);
                        
    //                     // Department
                        
    //                     var etdname=document.createElement("td");
    //                     etdname.innerHTML=js.data[j].department;
    //                     etdname.setAttribute("class",`text-center`);
    //                     etrb1.appendChild(etdname);
                        
    //                     // In
                        
    //                     var etdname=document.createElement("td");
    //                     var div1 = document.createElement("div");
    //                     div1.innerHTML = "IN";
    //                     div1.style.border = "1px solid black";
    //                     div1.setAttribute("class",`text-center p-2`);
                        
    //                     // Out
                        
    //                     var div2 = document.createElement("div");
    //                     div2.innerHTML = "OUT";
    //                     div2.style.border = "1px solid black";
    //                     div2.setAttribute("class",`text-center p-2`);
                        
    //                     // Duration
                        
    //                     var div3 = document.createElement("div");
    //                     div3.innerHTML = "Duration";
    //                     div3.style.border = "1px solid black";
    //                     div3.setAttribute("class",`text-center p-2`);
                        
    //                     etdname.appendChild(div1);
    //                     etdname.appendChild(div2);
    //                     etdname.appendChild(div3);
    //                     etrb1.appendChild(etdname);
    //                     etrb1.setAttribute("class",`text-center`);
                        
    //                     // First In & Last Out 
                        
    //                         for (var k=1; k<=totdays;k++){
                                
    //                         var etd=document.createElement("td");
                            
    //                         if(fromdate.clone().add(k-1,'days').format("dddd")==woff){
                               
    //                             // etd.innerHTML = "WO";
    //                             var maindiv1 = document.createElement("div");
                            
    //                             // In Time
                                
    //                             var div11 = document.createElement("div");
    //                             div11.style.border = "1px solid black";
    //                             div11.innerHTML = "00:00:00";
    //                             div11.setAttribute("class",`text-center p-2`);
                            
    //                             // Out Time
                                
    //                             var div22 = document.createElement("div");
    //                             div22.style.border = "1px solid black";
    //                             div22.innerHTML = "00:00:00";
    //                             div22.setAttribute("class",`text-center p-2`);
        
    //                             // Duration
                                
    //                             var div33 = document.createElement("div");
    //                             div33.style.border = "1px solid black";
    //                             div33.innerHTML = "00:00:00";
    //                             div33.setAttribute("class",`text-center p-2`);
    
                            
    //                             maindiv1.appendChild(div11);
    //                             maindiv1.appendChild(div22);
    //                             maindiv1.appendChild(div33);
    //                             etd.appendChild(maindiv1);
                                
    //                         } // if ends here
                            
    //                         else {
                                
    //                             etd.innerHTML=""; 
                                
    //                         } // else ends here
                            
    //                         etd.setAttribute("id",`ee${j}dd${k}`);
    //                         etrb1.appendChild(etd);
    //                         etrb1.setAttribute("class",`text-center`);
                            
    //                     } // for loop for k ends her

    //                     // Count no of days present
                        
    //                     var etdname=document.createElement("td");
                        
    //                     for (var p=0;p<res.message.attendance_one.length;p++){
                            
    //                         var citem=res.message.attendance_one[p];
                            
    //                         if(js.data[j].employee==citem.Employee){
                                
    //                             etdname.innerHTML=citem.No_of_Present_Days;
                                 
    //                         } // if ends here
                            
    //                     } // for loop ends here
                       
    //                     etrb1.appendChild(etdname);
                        
    //                     // No of present days
                        
    //                     // var etdname=document.createElement("td");
    //                     // var days=0; var work_hours=0; var act_work_hour=0;
    //                     // for (var p=0;p<res.message.attendance_one.length;p++){
                            
    //                     //     var ditem=res.message.attendance_one[p];
                            
    //                     //     if(js.data[j].employee==ditem.Employee){
                                
    //                     //         days=ditem.No_of_Present_Days;
    //                     //         work_hour=ditem.Available_no_of_Hours;
    //                     //         act_work_hour=ditem.Actual_no_of_Hours;
                                
    //                     //         if((act_work_hour-work_hour)>0){
                                    
    //                     //             etdname.innerHTML=Math.round(act_work_hour-work_hour);
                                    
    //                     //         } // if ends here
                                
    //                     //         else{
                                    
    //                     //             etdname.innerHTML=" "; 
                                    
    //                     //         } // else ends here
    //                     //     } // if ends here
    //                     // } // for loop ends here
                       
    //                     // etrb1.appendChild(etdname);
    //                     tbody.appendChild(etrb1);
                        
    //                 } // end for j loop

    //                 mtable.appendChild(tbody);
    //                 var wday=moment(res.message.attendance[0].WorkDate,"YYYY-MM-DD");
    //                 var day=wday.date(); var from_date;var to_date;
                    
    //                 for (var w=0; w<res.message.woffs.length;w++){
                         
    //                     from_date=moment(res.message.woffs[w].from_date,"YYYY-MM-DD");
    //                     to_date=moment(res.message.woffs[w].to_date,"YYYY-MM-DD");
    //                     // console.log("from start date " + from_date.diff(wday,"days"));
    //                     // console.log(wday.format("YYYY-MM-DD"));
    //                     // console.log("from end date " + to_date.diff(wday,"days"));
    //                     if (from_date.diff(wday,"days")<=0 && to_date.diff(wday,"days")>0){
                            
    //                         break;
                            
    //                     } // if ends here
    //                 } // for loop ends here
                    
    //                 for (j=0;j<js.data.length;j++){
                        
    //                     var doj=moment(js.data[j].date_of_joining,"YYYY-MM-DD");
    //                     var company=js.data[j].company;
    //                     var shift=js.data[j].default_shift;
    //                     var countp=0;var countlwp=0;var counta=0;
                        
    //                     // Holidays
                        
    //                     for ( m=0;m<res.message.holidays.length;m++){
                            
    //                         var d1=moment(res.message.holidays[m].holiday_date,"YYYY-MM-DD");
    //                         var hday=d1.date();
    //                         var el2=document.getElementById(`ee${j}dd${hday}`);
    //                         // el2.innerHTML="H";
                            
    //                         if(res.message.holidays[m].holiday_date!=' '){
                                
    //                             el2.innerHTML=" "
    //                             var maindiv2 = document.createElement("div");
                            
    //                             // In
                            
    //                             var div1111 = document.createElement("div");
    //                             div1111.style.border = "1px solid black";
    //                             div1111.innerHTML = "00:00:00";
    //                             div1111.setAttribute("class",`text-center p-2`);
                            
    //                             // Out
                                
    //                             var div2222 = document.createElement("div");
    //                             div2222.style.border = "1px solid black";
    //                             div2222.innerHTML = "00:00:00";
    //                             div2222.setAttribute("class",`text-center p-2`);
        
    //                             // Duration
                                
    //                             var div3333 = document.createElement("div");
    //                             div3333.style.border = "1px solid black";
    //                             div3333.innerHTML = "00:00:00";
    //                             div3333.setAttribute("class",`text-center p-2`);
    
                            
    //                             maindiv2.appendChild(div1111);
    //                             maindiv2.appendChild(div2222);
    //                             maindiv2.appendChild(div3333);
    //                             el2.appendChild(maindiv2);
                            
    //                         } // if ends here
                            
    //                     } // end for m loop
                        
    //                     // This loop is used for placing employee attendance record
                        
    //                     for (var l=0;l<res.message.attendance.length;l++){
                            
    //                         var bitem=res.message.attendance[l];
    //                         wday=moment(bitem.WorkDate,"YYYY-MM-DD");
    //                         day=wday.date();
                            
    //                         if (js.data[j].employee==bitem.Employee){
                                
    //                             var el=document.getElementById(`ee${j}dd${day}`);
    //                             var maindiv = document.createElement("div");
                                
    //                             // In
                                
    //                             var div111 = document.createElement("div");
    //                             div111.style.border = "1px solid black";
                                
    //                             if(bitem.LateIn !=" "){
                                    
    //                                 div111.innerHTML = bitem.FirstIn;
    //                                 div111.setAttribute("class",`text-center text-danger p-2`);
                                    
    //                             } // if ends here
                                
    //                             else{
                                    
    //                                 div111.innerHTML = bitem.FirstIn;
    //                                 div111.setAttribute("class",`text-center p-2`);
                                    
    //                             } // else ends here
                                
    //                             // Out
                                
    //                             var div222 = document.createElement("div");
    //                             div222.style.border = "1px solid black";
                                
    //                             if(bitem.LastOut !=" "){
                
    //                                 if(bitem.EarlyOut !=" "){
                                        
    //                                     div222.innerHTML = bitem.LastOut;
    //                                     div222.setAttribute("class",`text-center text-warning p-2`);
                                        
    //                                 } // if ends here
                                    
    //                                 else {
                                        
    //                                     div222.innerHTML = bitem.LastOut;
    //                                     div222.setAttribute("class",`text-center p-2`);
                                        
    //                                 } // else ends here
    //                             }
    //                             else {
                                    
    //                                 div222.innerHTML = "Missed";
    //                                 div222.setAttribute("class",`text-center p-2 text-warning`);
                                    
    //                             } // else ends her
                            
    //                             // Duration
                                
    //                             var div333 = document.createElement("div");
    //                             div333.style.border = "1px solid black";
                                
    //                             if(bitem.duration!=' '){
                                    
    //                                 div333.innerHTML = bitem.duration;
    //                                 div333.setAttribute("class",`text-center p-2`);
                                    
    //                             } // if ends here
                                
    //                             else {
                                    
    //                                 div333.style.height="37px";
                                    
    //                             } // else ends here
                                
    //                             maindiv.appendChild(div111);
    //                             maindiv.appendChild(div222);
    //                             maindiv.appendChild(div333);
    //                             el.innerHTML = "";
    //                             el.appendChild(maindiv);
                                
    //                         } // end if here
                            
    //                     } // end for l loop
                        
    //                     // This loop is used for placing employee leave record
                        
    //                     // for (var m=0;m<res.message.leaves.length;m++){
                            
    //                     //     if (js.data[j].employee==res.message.leaves[m].employee){
                                
    //                     //         for (var d=moment(res.message.leaves[m].from_date,"YYYY-MM-DD");d<=moment(res.message.leaves[m].to_date,"YYYY-MM-DD");d.add(1,"days")){
                                    
    //                     //             if (fromdate.month()===d.month()){
                                        
    //                     //                 var lday=d.date();
    //                     //                 var el1=document.getElementById(`ee${j}dd${lday}`);
                                    
    //                     //                 if (res.message.leaves[m].status==="Approved"){el1.innerHTML=el1.innerHTML+"L";}
    //                     //                 else if (res.message.leaves[m].status==="Open"){el1.innerHTML=el1.innerHTML+"O";}
    //                     //                 else if (res.message.leaves[m].status==="Rejected"){el1.innerHTML=el1.innerHTML+"R";}
    //                     //                 else if (res.message.leaves[m].status==="Cancelled"){el1.innerHTML=el1.innerHTML+"C";} 
                                        
    //                     //                 if (res.message.leaves[m].leave_type==="Leave Without Pay") {
                                            
    //                     //                     countlwp+=1;
                                            
    //                     //                 } // if ends here
    //                     //             } // if ends here
    //                     //         } // for loop for d ends here
    //                     //     } // if ends here
    //                     // }//end for m loop
                        
    //                     // Filling the remaining field with A
                        
    //                     for (var k=1; k<=totdays;k++){
                            
    //                         var etd=document.getElementById(`ee${j}dd${k}`);
    //                         var d2=date.format("YYYY-")+ date.month() + `-${k}`;
    //                         var att=`{"Employee":"${js.data[j].employee}","EmployeeName":"${js.data[j].employee_name}","WorkDate":"${d2}","FirstIn":"00:00:00","LastOut":"00:00:00","LateIn":"0","EarlyOut":"0","duration":""}`;
                                
    //                         if (etd.innerHTML==""){
                                
    //                             // console.log(doj);
                                
    //                             if((moment(d2,"YYYY-MM-DD").diff(doj))>=0){
                                    
    //                                 if(moment().diff(moment(d2,"YYYY-MM-DD"))>0) {
                                        
    //                                     // etd.innerHTML="A";
    //                                     var maindiv3 = document.createElement("div");
                            
    //                                         // In 
                                            
    //                                         var div11111 = document.createElement("div");
    //                                         div11111.style.border = "1px solid black";
    //                                         div11111.innerHTML = "00:00:00";
    //                                         div11111.setAttribute("class",`text-center p-2`);
                                        
    //                                         // Out
                                        
    //                                         var div22222 = document.createElement("div");
    //                                         div22222.style.border = "1px solid black";
    //                                         div22222.innerHTML = "00:00:00";
    //                                         div22222.setAttribute("class",`text-center p-2`);
                    
    //                                         // Duration
                                            
    //                                         var div33333 = document.createElement("div");
    //                                         div33333.style.border = "1px solid black";
    //                                         div33333.innerHTML = "00:00:00";
    //                                         div33333.setAttribute("class",`text-center p-2`);
                
                                        
    //                                         maindiv3.appendChild(div11111);
    //                                         maindiv3.appendChild(div22222);
    //                                         maindiv3.appendChild(div33333);
    //                                         etd.appendChild(maindiv3); 
                                    
    //                                 } // if ends here
    //                             } // if ends here
    //                         } // if ends here
    //                     } // end for k loop
    //                 } // end for j loop
    //             }); // end for employee fetch 
    //         } // end for callback res
    //     }); // end for monthly attendance fetch
    // } // function ends here

    // Display of data of Daily Production Report with given Employee & Month filter
    
    // function showMonthlyAttendanceWithEmployeeFilter_one(val,emp){
        
    //   var mtable=document.getElementById("monthly_attendance_one_table");
    //     mtable.innerHTML=" ";
        
    //     var thead=document.createElement("thead");
    //     var date=moment(val,"YYYY-MM-DD");
    //     var totdays=date.daysInMonth();
        
    //     var etr1=document.createElement("tr"); //el2=document.createElement("th");el2.innerHTML="H";
    //     var etr2=document.createElement("tr");
    //     var etr3=document.createElement("tr");
        
    //     var ethslno1=document.createElement("th");ethslno1.innerHTML="Sl.";etr1.appendChild(ethslno1);
    //     var ethslno1=document.createElement("th");ethslno1.innerHTML=" ";etr3.appendChild(ethslno1);
    //     var ethslno2=document.createElement("th");ethslno2.innerHTML="";etr2.appendChild(ethslno2);
        
    //     th=document.createElement("th");th.innerHTML="ID";etr1.appendChild(th);
    //     th=document.createElement("th");th.innerHTML=" ";etr3.appendChild(th);etr3.setAttribute("class",`text-center`);
    //     th=document.createElement("th");etr2.appendChild(th);
        
    //     var ethname1=document.createElement("th");ethname1.innerHTML="Name";etr1.appendChild(ethname1);
    //     var ethname1=document.createElement("th");ethname1.innerHTML=" ";etr3.appendChild(ethname1);
    //     var ethname2=document.createElement("th");ethname2.innerHTML="";etr2.appendChild(ethname2);
        
    //     th=document.createElement("th");th.innerHTML="Department";th.setAttribute("class",`text-center`);etr1.appendChild(th);
    //     th=document.createElement("th");th.innerHTML=" ";etr3.appendChild(th);etr3.setAttribute("class",`text-center`);
    //     th=document.createElement("th");etr2.appendChild(th);
    
    //     th=document.createElement("th");th.innerHTML="Time";th.setAttribute("class",`text-center`);etr1.appendChild(th);
    //     th=document.createElement("th");th.innerHTML=" ";etr3.appendChild(th);etr3.setAttribute("class",`text-center`);
    //     th=document.createElement("th");etr2.appendChild(th);
        
    //     for (var i=1; i<=totdays;i++){
            
    //         var dayname=date.format('dddd').substring(0,2);
    //         var eth=document.createElement("th");
    //         eth.innerHTML=dayname;etr1.appendChild(eth);
    //         var eth1=document.createElement("th");eth1.innerHTML="D"+i;etr2.appendChild(eth1);
    //         etr1.setAttribute("class",`text-center`);etr2.setAttribute("class",`text-center`);
    //         date=date.add(1, 'days');
            
    //     } // for loop for i ends here
        
    //     th=document.createElement("th");th.innerHTML="Present Days";th.setAttribute("class",`text-center`);etr1.appendChild(th);
    //     th=document.createElement("th");th.innerHTML=" ";etr3.appendChild(th);etr3.setAttribute("class",`text-center`);
    //     th=document.createElement("th");etr2.appendChild(th);
        
    //     thead.appendChild(etr1); 
    //     thead.appendChild(etr2);
    //     thead.appendChild(etr3);
    //     mtable.appendChild(thead);
        
    //     var tbody=document.createElement("tbody");
    //     var fromdate=moment(val,"YYYY-MM-DD");
    //     var todate=fromdate.clone().add(totdays-1,'days');
       
    //     frappe.call({method:'form_d_type_2_report',
        
    //         args : {fromdate:fromdate.format("YYYY-MM-DD"),todate:todate.format("YYYY-MM-DD")},
            
    //             callback : (res)=>{ // console.log(res);
                
    //             var url=`/api/resource/Employee/?filters=[["status","=","Active"]]&fields=["employee","employee_name","department","designation","branch","company","default_shift","holiday_list","date_of_joining"]`;
    
    //             var woff=res.message.woffs[0].weekly_off;
        
    //             fetch(url).then((r)=>r.json()).then((js)=>{
            
    //                 for (var j=0; j<js.data.length;j++){
                    
    //                     var etrb1=document.createElement("tr");

    //                     // Sl No.
                        
    //                     var etdslno=document.createElement("td");
    //                     etdslno.innerHTML=j+1;
    //                     etrb1.appendChild(etdslno);
                        
    //                     // Employee Id
                        
    //                     var etdid=document.createElement("td");
    //                     etdid.innerHTML=js.data[j].employee;
    //                     etdid.setAttribute("id",`${j}0`);
    //                     etrb1.appendChild(etdid);
    //                     etrb1.setAttribute("class","text-center");
                        
    //                     // Employee Name
                        
    //                     var etdname=document.createElement("td");
    //                     etdname.innerHTML=js.data[j].employee_name;
    //                     etdname.setAttribute("class",`text-center`);
    //                     etrb1.appendChild(etdname);
                        
    //                     // Department
                        
    //                     var etdname=document.createElement("td");
    //                     etdname.innerHTML=js.data[j].department;
    //                     etdname.setAttribute("class",`text-center`);
    //                     etrb1.appendChild(etdname);
                        
    //                     // In
                        
    //                     var etdname=document.createElement("td");
    //                     var div1 = document.createElement("div");
    //                     div1.innerHTML = "IN";
    //                     div1.style.border = "1px solid black";
    //                     div1.setAttribute("class",`text-center p-2`);
                        
    //                     // Out
                        
    //                     var div2 = document.createElement("div");
    //                     div2.innerHTML = "OUT";
    //                     div2.style.border = "1px solid black";
    //                     div2.setAttribute("class",`text-center p-2`);
                        
    //                     // Duration
                        
    //                     var div3 = document.createElement("div");
    //                     div3.innerHTML = "Duration";
    //                     div3.style.border = "1px solid black";
    //                     div3.setAttribute("class",`text-center p-2`);
                        
    //                     etdname.appendChild(div1);
    //                     etdname.appendChild(div2);
    //                     etdname.appendChild(div3);
    //                     etrb1.appendChild(etdname);
    //                     etrb1.setAttribute("class",`text-center`);
                        
    //                     // First In & Last Out 
                        
    //                         for (var k=1; k<=totdays;k++){
                                
    //                         var etd=document.createElement("td");
                            
    //                         if(fromdate.clone().add(k-1,'days').format("dddd")==woff){
                               
    //                             // etd.innerHTML = "WO";
    //                             var maindiv1 = document.createElement("div");
                            
    //                             // In Time
                                
    //                             var div11 = document.createElement("div");
    //                             div11.style.border = "1px solid black";
    //                             div11.innerHTML = "00:00:00";
    //                             div11.setAttribute("class",`text-center p-2`);
                            
    //                             // Out Time
                                
    //                             var div22 = document.createElement("div");
    //                             div22.style.border = "1px solid black";
    //                             div22.innerHTML = "00:00:00";
    //                             div22.setAttribute("class",`text-center p-2`);
        
    //                             // Duration
                                
    //                             var div33 = document.createElement("div");
    //                             div33.style.border = "1px solid black";
    //                             div33.innerHTML = "00:00:00";
    //                             div33.setAttribute("class",`text-center p-2`);
    
                            
    //                             maindiv1.appendChild(div11);
    //                             maindiv1.appendChild(div22);
    //                             maindiv1.appendChild(div33);
    //                             etd.appendChild(maindiv1);
                                
    //                         } // if ends here
                            
    //                         else {
                                
    //                             etd.innerHTML=""; 
                                
    //                         } // else ends here
                            
    //                         etd.setAttribute("id",`ee${j}dd${k}`);
    //                         etrb1.appendChild(etd);
    //                         etrb1.setAttribute("class",`text-center`);
                            
    //                     } // for loop for k ends her

    //                     // Count no of days present
                        
    //                     var etdname=document.createElement("td");
                        
    //                     for (var p=0;p<res.message.attendance_one.length;p++){
                            
    //                         var citem=res.message.attendance_one[p];
                            
    //                         if(js.data[j].employee==citem.Employee){
                                
    //                             etdname.innerHTML=citem.No_of_Present_Days;
                                 
    //                         } // if ends here
                            
    //                     } // for loop ends here
                       
    //                     etrb1.appendChild(etdname);
                        
    //                     // No of present days
                        
    //                     // var etdname=document.createElement("td");
    //                     // var days=0; var work_hours=0; var act_work_hour=0;
    //                     // for (var p=0;p<res.message.attendance_one.length;p++){
                            
    //                     //     var ditem=res.message.attendance_one[p];
                            
    //                     //     if(js.data[j].employee==ditem.Employee){
                                
    //                     //         days=ditem.No_of_Present_Days;
    //                     //         work_hour=ditem.Available_no_of_Hours;
    //                     //         act_work_hour=ditem.Actual_no_of_Hours;
                                
    //                     //         if((act_work_hour-work_hour)>0){
                                    
    //                     //             etdname.innerHTML=Math.round(act_work_hour-work_hour);
                                    
    //                     //         } // if ends here
                                
    //                     //         else{
                                    
    //                     //             etdname.innerHTML=" "; 
                                    
    //                     //         } // else ends here
    //                     //     } // if ends here
    //                     // } // for loop ends here
                       
    //                     // etrb1.appendChild(etdname);
    //                     tbody.appendChild(etrb1);
                        
    //                 } // end for j loop

    //                 mtable.appendChild(tbody);
    //                 var wday=moment(res.message.attendance[0].WorkDate,"YYYY-MM-DD");
    //                 var day=wday.date(); var from_date;var to_date;
                    
    //                 for (var w=0; w<res.message.woffs.length;w++){
                         
    //                     from_date=moment(res.message.woffs[w].from_date,"YYYY-MM-DD");
    //                     to_date=moment(res.message.woffs[w].to_date,"YYYY-MM-DD");
    //                     // console.log("from start date " + from_date.diff(wday,"days"));
    //                     // console.log(wday.format("YYYY-MM-DD"));
    //                     // console.log("from end date " + to_date.diff(wday,"days"));
    //                     if (from_date.diff(wday,"days")<=0 && to_date.diff(wday,"days")>0){
                            
    //                         break;
                            
    //                     } // if ends here
    //                 } // for loop ends here
                    
    //                 for (j=0;j<js.data.length;j++){
                        
    //                     var doj=moment(js.data[j].date_of_joining,"YYYY-MM-DD");
    //                     var company=js.data[j].company;
    //                     var shift=js.data[j].default_shift;
    //                     var countp=0;var countlwp=0;var counta=0;
                        
    //                     // Holidays
                        
    //                     for ( m=0;m<res.message.holidays.length;m++){
                            
    //                         var d1=moment(res.message.holidays[m].holiday_date,"YYYY-MM-DD");
    //                         var hday=d1.date();
    //                         var el2=document.getElementById(`ee${j}dd${hday}`);
    //                         // el2.innerHTML="H";
                            
    //                         if(res.message.holidays[m].holiday_date!=' '){
                                
    //                             el2.innerHTML=" "
    //                             var maindiv2 = document.createElement("div");
                            
    //                             // In
                            
    //                             var div1111 = document.createElement("div");
    //                             div1111.style.border = "1px solid black";
    //                             div1111.innerHTML = "00:00:00";
    //                             div1111.setAttribute("class",`text-center p-2`);
                            
    //                             // Out
                                
    //                             var div2222 = document.createElement("div");
    //                             div2222.style.border = "1px solid black";
    //                             div2222.innerHTML = "00:00:00";
    //                             div2222.setAttribute("class",`text-center p-2`);
        
    //                             // Duration
                                
    //                             var div3333 = document.createElement("div");
    //                             div3333.style.border = "1px solid black";
    //                             div3333.innerHTML = "00:00:00";
    //                             div3333.setAttribute("class",`text-center p-2`);
    
                            
    //                             maindiv2.appendChild(div1111);
    //                             maindiv2.appendChild(div2222);
    //                             maindiv2.appendChild(div3333);
    //                             el2.appendChild(maindiv2);
                            
    //                         } // if ends here
                            
    //                     } // end for m loop
                        
    //                     // This loop is used for placing employee attendance record
                        
    //                     for (var l=0;l<res.message.attendance.length;l++){
                            
    //                         var bitem=res.message.attendance[l];
    //                         wday=moment(bitem.WorkDate,"YYYY-MM-DD");
    //                         day=wday.date();
                            
    //                         if (js.data[j].employee==bitem.Employee){
                                
    //                             var el=document.getElementById(`ee${j}dd${day}`);
    //                             var maindiv = document.createElement("div");
                                
    //                             // In
                                
    //                             var div111 = document.createElement("div");
    //                             div111.style.border = "1px solid black";
                                
    //                             if(bitem.LateIn !=" "){
                                    
    //                                 div111.innerHTML = bitem.FirstIn;
    //                                 div111.setAttribute("class",`text-center text-danger p-2`);
                                    
    //                             } // if ends here
                                
    //                             else{
                                    
    //                                 div111.innerHTML = bitem.FirstIn;
    //                                 div111.setAttribute("class",`text-center p-2`);
                                    
    //                             } // else ends here
                                
    //                             // Out
                                
    //                             var div222 = document.createElement("div");
    //                             div222.style.border = "1px solid black";
                                
    //                             if(bitem.LastOut !=" "){
                
    //                                 if(bitem.EarlyOut !=" "){
                                        
    //                                     div222.innerHTML = bitem.LastOut;
    //                                     div222.setAttribute("class",`text-center text-warning p-2`);
                                        
    //                                 } // if ends here
                                    
    //                                 else {
                                        
    //                                     div222.innerHTML = bitem.LastOut;
    //                                     div222.setAttribute("class",`text-center p-2`);
                                        
    //                                 } // else ends here
    //                             }
    //                             else {
                                    
    //                                 div222.innerHTML = "Missed";
    //                                 div222.setAttribute("class",`text-center p-2 text-warning`);
                                    
    //                             } // else ends her
                            
    //                             // Duration
                                
    //                             var div333 = document.createElement("div");
    //                             div333.style.border = "1px solid black";
                                
    //                             if(bitem.duration!=' '){
                                    
    //                                 div333.innerHTML = bitem.duration;
    //                                 div333.setAttribute("class",`text-center p-2`);
                                    
    //                             } // if ends here
                                
    //                             else {
                                    
    //                                 div333.style.height="37px";
                                    
    //                             } // else ends here
                                
    //                             maindiv.appendChild(div111);
    //                             maindiv.appendChild(div222);
    //                             maindiv.appendChild(div333);
    //                             el.innerHTML = "";
    //                             el.appendChild(maindiv);
                                
    //                         } // end if here
                            
    //                     } // end for l loop
                        
    //                     // This loop is used for placing employee leave record
                        
    //                     // for (var m=0;m<res.message.leaves.length;m++){
                            
    //                     //     if (js.data[j].employee==res.message.leaves[m].employee){
                                
    //                     //         for (var d=moment(res.message.leaves[m].from_date,"YYYY-MM-DD");d<=moment(res.message.leaves[m].to_date,"YYYY-MM-DD");d.add(1,"days")){
                                    
    //                     //             if (fromdate.month()===d.month()){
                                        
    //                     //                 var lday=d.date();
    //                     //                 var el1=document.getElementById(`ee${j}dd${lday}`);
                                    
    //                     //                 if (res.message.leaves[m].status==="Approved"){el1.innerHTML=el1.innerHTML+"L";}
    //                     //                 else if (res.message.leaves[m].status==="Open"){el1.innerHTML=el1.innerHTML+"O";}
    //                     //                 else if (res.message.leaves[m].status==="Rejected"){el1.innerHTML=el1.innerHTML+"R";}
    //                     //                 else if (res.message.leaves[m].status==="Cancelled"){el1.innerHTML=el1.innerHTML+"C";} 
                                        
    //                     //                 if (res.message.leaves[m].leave_type==="Leave Without Pay") {
                                            
    //                     //                     countlwp+=1;
                                            
    //                     //                 } // if ends here
    //                     //             } // if ends here
    //                     //         } // for loop for d ends here
    //                     //     } // if ends here
    //                     // }//end for m loop
                        
    //                     // Filling the remaining field with A
                        
    //                     for (var k=1; k<=totdays;k++){
                            
    //                         var etd=document.getElementById(`ee${j}dd${k}`);
    //                         var d2=date.format("YYYY-")+ date.month() + `-${k}`;
    //                         var att=`{"Employee":"${js.data[j].employee}","EmployeeName":"${js.data[j].employee_name}","WorkDate":"${d2}","FirstIn":"00:00:00","LastOut":"00:00:00","LateIn":"0","EarlyOut":"0","duration":""}`;
                                
    //                         if (etd.innerHTML==""){
                                
    //                             // console.log(doj);
                                
    //                             if((moment(d2,"YYYY-MM-DD").diff(doj))>=0){
                                    
    //                                 if(moment().diff(moment(d2,"YYYY-MM-DD"))>0) {
                                        
    //                                     // etd.innerHTML="A";
    //                                     var maindiv3 = document.createElement("div");
                            
    //                                         // In 
                                            
    //                                         var div11111 = document.createElement("div");
    //                                         div11111.style.border = "1px solid black";
    //                                         div11111.innerHTML = "00:00:00";
    //                                         div11111.setAttribute("class",`text-center p-2`);
                                        
    //                                         // Out
                                        
    //                                         var div22222 = document.createElement("div");
    //                                         div22222.style.border = "1px solid black";
    //                                         div22222.innerHTML = "00:00:00";
    //                                         div22222.setAttribute("class",`text-center p-2`);
                    
    //                                         // Duration
                                            
    //                                         var div33333 = document.createElement("div");
    //                                         div33333.style.border = "1px solid black";
    //                                         div33333.innerHTML = "00:00:00";
    //                                         div33333.setAttribute("class",`text-center p-2`);
                
                                        
    //                                         maindiv3.appendChild(div11111);
    //                                         maindiv3.appendChild(div22222);
    //                                         maindiv3.appendChild(div33333);
    //                                         etd.appendChild(maindiv3); 
                                    
    //                                 } // if ends here
    //                             } // if ends here
    //                         } // if ends here
    //                     } // end for k loop
    //                 } // end for j loop
    //             }); // end for employee fetch 
    //         } // end for callback res
    //     }); // end for monthly attendance fetch
    // } // function ends here
    
    // Display of data of Daily Production Report with given Month filter
    
    function showMonthlyAttendance_one(val){
    
        var mtablediv = document.getElementById("monthly_attendance_one_div");
        var mtable  = document.getElementById("monthly_attendance_one_table");
        mtable.innerHTML=" ";
        var date=moment(val,"YYYY-MM-DD");
        var totdays=date.daysInMonth();
        var fromdate=moment(val,"YYYY-MM-DD");
        var todate=fromdate.clone().add(totdays-1,'days');
        // console.log(fromdate.format("YYYY-MM-DD"));
        // console.log(todate.format("YYYY-MM-DD"));
        
        // Table starts here

        // var mtable=document.createElement("table");
        // mtable.setAttribute("class","table table-bordered");
        var thead=document.createElement("thead");
        var etr1=document.createElement("tr");
        var etr2=document.createElement("tr");
        
        // Id
        
        var ethname1=document.createElement("th");
        ethname1.innerHTML="ID";
        ethname1.setAttribute('rowSpan', '2');
        ethname1.setAttribute('class', 'text-center align-middle');
        ethname1.setAttribute('id', 'tdId');
        etr1.appendChild(ethname1);

        // Name
        
        var ethname11=document.createElement("th");
        ethname11.innerHTML="Name";
        ethname11.setAttribute('rowSpan', '2');
        ethname11.setAttribute('class', 'text-center align-middle');
        ethname11.setAttribute('id', 'tdName');
        etr1.appendChild(ethname11);
        
        // In / Out
        
        var ethname111=document.createElement("th");
        ethname111.innerHTML="";
        ethname111.setAttribute('rowSpan', '2');
        ethname111.setAttribute('class', 'text-center align-middle');
        ethname111.setAttribute('id', 'tdTime');
        etr1.appendChild(ethname111);

        for (var i=1; i<=totdays;i++){
            
            var dayname=date.format('dddd').substring(0,2);
            var eth=document.createElement("th");
            eth.innerHTML=dayname;etr1.appendChild(eth);
            var eth1=document.createElement("th");
            eth1.innerHTML=i;etr2.appendChild(eth1);
            date=date.add(1, 'days');
            
        } // for loop ends here
        
        // Total Days
        
        var ethname1111=document.createElement("th");
        ethname1111.innerHTML="Total Days";
        ethname1111.setAttribute('rowSpan', '2');
        ethname1111.setAttribute('class', 'text-center align-middle');
        etr1.appendChild(ethname1111);

        // Total Hour
        
        var ethname11111=document.createElement("th");
        ethname11111.innerHTML="Total Hour";
        ethname11111.setAttribute('rowSpan', '2');
        ethname11111.setAttribute('class', 'text-center align-middle');
        etr1.appendChild(ethname11111);

        thead.appendChild(etr1); 
        thead.appendChild(etr2);
        mtable.appendChild(thead);
        
            frappe.call({method:'form_d_type_2_report',
            args : {fromdate:fromdate.format("YYYY-MM-DD"),todate:todate.format("YYYY-MM-DD")},
            callback : (res)=>{
                
                console.log(res.message.attendance);
                var url=`/api/resource/Employee/?filters=[["status","=","Active"]]&fields=["employee","employee_name","department","date_of_joining"]&limit_page_length=None`;
                // console.log(url);
        
                fetch(url).then((r)=>r.json()).then((js)=>{console.log(js);
    
                for (var j=0; j<js.data.length;j++){
                    
                    var tbody=document.createElement("tbody");

                    etr1=document.createElement("tr");
                    
                    // Id
                    
                    var etd=document.createElement("td");
                    etd.innerHTML=js.data[j].employee;
                    etd.setAttribute('rowSpan', '3');
                    etd.setAttribute('class', 'text-center align-middle id_td');
                    etd.style.backgroundColor = '#ffffff';
                    etr1.appendChild(etd);
                    
                    // Name
                    
                    var etd=document.createElement("td");
                    etd.innerHTML=js.data[j].employee_name;
                    etd.setAttribute('rowSpan', '3');
                    etd.setAttribute('class', 'text-center align-middle name_td');
                    etd.style.backgroundColor = '#ffffff';
                    etr1.appendChild(etd);
                    
                    // create in time row
                    
                    var etd=document.createElement("td");
                    etd.innerHTML="In";
                    etd.setAttribute("class",`text-left in_td`);
                    etd.style.backgroundColor = '#ffffff';
                    etr1.appendChild(etd);
                    
                    for (var i=1; i<=totdays;i++){
                        
                        etd=document.createElement("td");
                        etd.setAttribute("id",`in${j}d${i}`);
                        etd.setAttribute("class",`text-center`);
                        etd.innerHTML="";
                        etr1.appendChild(etd);
                        
                    } // for loop ends here
                    
                    tbody.appendChild(etr1);
                    
                    // Create out time row
                    
                    etr2=document.createElement("tr");
                    
                    var etd=document.createElement("td");
                    etd.innerHTML="Out";
                    etd.setAttribute("class",`text-left out_td`);
                    etd.style.backgroundColor = '#ffffff';
                    etr2.appendChild(etd);
                    
                    for (var i=1; i<=totdays;i++){
                        
                        etd=document.createElement("td");
                        etd.setAttribute("id",`out${j}d${i}`);
                        etd.setAttribute("class",`text-center`);
                        etd.innerHTML="";
                        etr2.appendChild(etd);
                        
                    } // for loop ends here
                    
                    tbody.appendChild(etr2);
                
                    // Create duration row
                    
                    etr3=document.createElement("tr");
                    
                    var etd=document.createElement("td");
                    etd.innerHTML="Duration";
                    etd.setAttribute("class",`text-center dur_td`);
                    etd.style.backgroundColor = '#ffffff';
                    etr3.appendChild(etd);
                    
                    for (var i=1; i<=totdays;i++){
                        
                        etd=document.createElement("td");
                        etd.setAttribute("id",`dur${j}d${i}`);
                        etd.setAttribute("class",`text-center`);
                        etd.innerHTML="";
                        etr3.appendChild(etd);
                        
                    } // for loop ends here
                    
                    tbody.appendChild(etr3);
                    
                    // Total Days
                     
                    var etd=document.createElement("td");
                    
                     for (var p=0;p<res.message.attendance_one.length;p++){
                                
                        var citem=res.message.attendance_one[p];
                        
                        if(js.data[j].employee==citem.Employee){
                            
                            etd.innerHTML=citem.No_of_Present_Days;
                             
                        } // if ends here
                        
                    } // for loop ends here
                    
                    // etd.innerHTML=js.data[j].employee;
                    etd.setAttribute('rowSpan', '3');
                    etd.setAttribute('class', 'text-center align-middle');
                    etr1.appendChild(etd);
                    
                    // Total Hour
                    
                    var etd=document.createElement("td");
                    
                    for (var s=0;s<res.message.attendance_two.length;s++){
                                
                        var ditem=res.message.attendance_two[s];
                        
                        if(js.data[j].employee==ditem.Employee){
                            
                            etd.innerHTML=ditem.Actual_no_of_Hours;
                             
                        } // if ends here
                        
                    } // for loop ends here
                    
                    // etd.innerHTML=js.data[j].employee_name;
                    etd.setAttribute('rowSpan', '3');
                    etd.setAttribute('class', 'text-center align-middle');
                    etr1.appendChild(etd);
                
                    mtable.appendChild(tbody);
                    mtablediv.appendChild(mtable);   
                    
                }//end for j loop over employee
                
                for (j=0;j<js.data.length;j++){
                   
                    //  var doj=moment(js.data[j].date_of_joining,"YYYY-MM-DD");
                    //  console.log(moment(doj).format("DD//MM/YYYY"))
                    var countp=0;var countlwp=0;var counta=0;
                    
                    // Holiday
                    
                    for ( m=0;m<res.message.holidays.length;m++){
                                
                        var d1=moment(res.message.holidays[m].holiday_date,"YYYY-MM-DD");
                        var hday=d1.date();
                        var el21=document.getElementById(`in${j}d${hday}`);
                        
                        if (el21!=" "){
                            
                            el21.innerHTML="00:00";
                            
                        } // if ends here
                        
                        var el22=document.getElementById(`out${j}d${hday}`);
                        
                        if (el22!=" "){
                            
                            el22.innerHTML="00:00";
                            
                        } // if ends here
                        
                        var el23=document.getElementById(`dur${j}d${hday}`);
                        
                        if (el23!=" "){
                            
                            el23.innerHTML="00:00";
                            
                        } // if ends here
                        
                    } // end for m here
                    
                    // This loop is used for placing employee attendance record
                    
                    for (var l=0;l<res.message.attendance.length;l++){
                        
                        wday=moment(res.message.attendance[l].WorkDate,"YYYY-MM-DD");
                        day=wday.date();
                        
                        if (js.data[j].employee==res.message.attendance[l].Employee){
                            
                            var elin=document.getElementById(`in${j}d${day}`);
                            var elout=document.getElementById(`out${j}d${day}`);
                            // var ellate=document.getElementById(`late${j}${day}`);
                            // var elearly=document.getElementById(`early${j}${day}`);
                            var eldur=document.getElementById(`dur${j}d${day}`);
                            // var elstatus=document.getElementById(`status${j}${day}`);
                            
                            if(res.message.attendance[l].LateIn !=" "){
                            
                                elin.innerHTML= moment(res.message.attendance[l].FirstIn,"HH:mm:ss").format("HH:mm");
                                elin.setAttribute("class",`text-center text-danger p-2`);
                        
                            } // if ends here
                            
                            else{
                                
                                elin.innerHTML= moment(res.message.attendance[l].FirstIn,"HH:mm:ss").format("HH:mm");
                                
                            } // else ends here
                        
                            if(res.message.attendance[l].EarlyOut !=" "){
                            
                                if(res.message.attendance[l].LastOut=="Missed"){
                                    
                                    // elout.innerHTML= res.message.attendance[l].LastOut;
                                    elout.innerHTML= "00:00";
                                    // elout.setAttribute("class",`text-center text-warning p-2`);
                                    
                                } // if ends here
                                
                                else if(res.message.attendance[l].LastOut== " "){
                                    
                                    elout.innerHTML= "00:00";
                                    // elout.setAttribute("class",`text-center text-warning p-2`);
                                    
                                } // else if ends here
                                
                                else{
                                    
                                    elout.innerHTML= moment(res.message.attendance[l].LastOut,"HH:mm:ss").format("HH:mm");
                                    elout.setAttribute("class",`text-center text-warning p-2`);
                                    
                                } // else ends here
                                
                            } // if ends here
                            
                            else {
                                
                                if(res.message.attendance[l].LastOut=="Missed"){
                                    
                                    // elout.innerHTML= res.message.attendance[l].LastOut;
                                    elout.innerHTML= "00:00";
                                    // elout.setAttribute("class",`text-center text-warning p-2`);
                                    
                                } // if ends here 
                                
                                else if(res.message.attendance[l].LastOut == " "){
                                    
                                    elout.innerHTML= "00:00";
                                    
                                } // else if ends here
                                
                                else{
                                    
                                    elout.innerHTML= moment(res.message.attendance[l].LastOut,"HH:mm:ss").format("HH:mm");
                                    
                                } // else ends here
                                
                            } // else ends here
                        
                            if(res.message.attendance[l].duration !=" ") {
                                
                                eldur.innerHTML= moment(res.message.attendance[l].duration,"HH:mm:ss").format("HH:mm"); 
                                
                            } // if ends here
                        
                            else {
                            
                                eldur.innerHTML= "00:00";
                                
                            } // else ends here
                            
                        // elout.innerHTML= res.message.attendance[l].LastOut;
                        // ellate.innerHTML= res.message.attendance[l].LateIn;
                        // elearly.innerHTML= res.message.attendance[l].EarlyOut;
                        // eldur.innerHTML= res.message.attendance[l].duration;
                        // elstatus.innerHTML= res.message.attendance[l].Status;
                    }//end if
                }//end for l  

                    // For remaining  field filled with A
                    
                    for (var k=1; k<=totdays;k++){
                                
                        // var el3=document.getElementById(`status${j}${k}`);
                        var el31=document.getElementById(`in${j}d${k}`);
                        var el32=document.getElementById(`out${j}d${k}`);
                        var el33=document.getElementById(`dur${j}d${k}`);
                        // var d2=date.format("YYYY-")+ date.month() + `-${k}`;
                        
                        // if (el31.innerHTML=="" || el32.innerHTML==""  || el33.innerHTML=="" ){
                            
                        //     if((moment(d2,"YYYY-MM-DD").diff(doj))>=0){
                                
                        //         if(moment().diff(moment(d2,"YYYY-MM-DD"))>0) {
                                    
                        //             // el3.innerHTML="A";  
                        //             el31.innerHTML="00:00";
                        //             el32.innerHTML="00:00";
                        //             el33.innerHTML="00:00";
                                    
                        //         } // if ends here
                        //     } // if ends here
                        // } // if ends here
                        
                        if (el31.innerHTML==""){
                            
                            el31.innerHTML="00:00";
                            
                        } // if ends here
                        
                        if(el32.innerHTML==""){
                            
                            el32.innerHTML="00:00";
                            
                        } // if ends here
                        
                        if(el33.innerHTML==""){
                            
                            el33.innerHTML="00:00";
                            
                        } // if ends here

                    } // end for k loop
                }//end of j
            });//end of fetch employee
            }//end for callback res
        }); // frappe.call ends here 
    } // function ends here
 
   // Display of data of Daily Production Report with given Employee & Month filter

    function showMonthlyAttendanceWithEmployeeFilter_one(val,emp){
    
        var mtablediv = document.getElementById("monthly_attendance_one_div");
        var mtable  = document.getElementById("monthly_attendance_one_table");
        mtable.innerHTML=" ";
        var date=moment(val,"YYYY-MM-DD");
        var totdays=date.daysInMonth();
        var fromdate=moment(val,"YYYY-MM-DD");
        var todate=fromdate.clone().add(totdays-1,'days');
        // console.log(fromdate.format("YYYY-MM-DD"));
        // console.log(todate.format("YYYY-MM-DD"));
        
        // Table starts here

        // var mtable=document.createElement("table");
        // mtable.setAttribute("class","table table-bordered");
        var thead=document.createElement("thead");
        var etr1=document.createElement("tr");
        var etr2=document.createElement("tr");
        
        // Id
        
        var ethname1=document.createElement("th");
        ethname1.innerHTML="ID";
        ethname1.setAttribute('rowSpan', '2');
        ethname1.setAttribute('class', 'text-center align-middle');
        ethname1.setAttribute('id', 'tdId');
        etr1.appendChild(ethname1);

        // Name
        
        var ethname11=document.createElement("th");
        ethname11.innerHTML="Name";
        ethname11.setAttribute('rowSpan', '2');
        ethname11.setAttribute('class', 'text-center align-middle');
        ethname11.setAttribute('id', 'tdName');
        etr1.appendChild(ethname11);
        
        // In / Out
        
        var ethname111=document.createElement("th");
        ethname111.innerHTML="";
        ethname111.setAttribute('rowSpan', '2');
        ethname111.setAttribute('class', 'text-center align-middle');
        ethname111.setAttribute('id', 'tdTime');
        etr1.appendChild(ethname111);

        for (var i=1; i<=totdays;i++){
            
            var dayname=date.format('dddd').substring(0,2);
            var eth=document.createElement("th");
            eth.innerHTML=dayname;etr1.appendChild(eth);
            var eth1=document.createElement("th");
            eth1.innerHTML=i;etr2.appendChild(eth1);
            date=date.add(1, 'days');
            
        } // for loop ends here
        
        // Total Days
        
        var ethname1111=document.createElement("th");
        ethname1111.innerHTML="Total Days";
        ethname1111.setAttribute('rowSpan', '2');
        ethname1111.setAttribute('class', 'text-center align-middle');
        etr1.appendChild(ethname1111);

        // Total Hour
        
        var ethname11111=document.createElement("th");
        ethname11111.innerHTML="Total Hour";
        ethname11111.setAttribute('rowSpan', '2');
        ethname11111.setAttribute('class', 'text-center align-middle');
        etr1.appendChild(ethname11111);

        thead.appendChild(etr1); 
        thead.appendChild(etr2);
        mtable.appendChild(thead);
        
            frappe.call({method:'form_d_type_2_report',
            args : {fromdate:fromdate.format("YYYY-MM-DD"),todate:todate.format("YYYY-MM-DD")},
            callback : (res)=>{
                
                var encodedEmp = encodeURIComponent(emp);
            
                // console.log(res.message.attendance);
                var url=`/api/resource/Employee/?filters=[["status","=","Active"],["employee","=","${encodedEmp}"]]&fields=["employee","employee_name","department","date_of_joining"]&limit_page_length=None`;
        
                fetch(url).then((r)=>r.json()).then((js)=>{ // console.log(js);
    
                for (var j=0; j<js.data.length;j++){
                    
                    var tbody=document.createElement("tbody");

                    etr1=document.createElement("tr");
                    
                    // Id
                    
                    var etd=document.createElement("td");
                    etd.innerHTML=js.data[j].employee;
                    etd.setAttribute('rowSpan', '3');
                    etd.setAttribute('class', 'text-center align-middle id_td');
                    etd.style.backgroundColor = '#ffffff';
                    etr1.appendChild(etd);
                    
                    // Name
                    
                    var etd=document.createElement("td");
                    etd.innerHTML=js.data[j].employee_name;
                    etd.setAttribute('rowSpan', '3');
                    etd.setAttribute('class', 'text-center align-middle name_td');
                    etd.style.backgroundColor = '#ffffff';
                    etr1.appendChild(etd);
                    
                    // create in time row
                    
                    var etd=document.createElement("td");
                    etd.innerHTML="In";
                    etd.setAttribute("class",`text-left in_td`);
                    etd.style.backgroundColor = '#ffffff';
                    etr1.appendChild(etd);
                    
                    for (var i=1; i<=totdays;i++){
                        
                        etd=document.createElement("td");
                        etd.setAttribute("id",`in${j}d${i}`);
                        etd.setAttribute("class",`text-center`);
                        etd.innerHTML="";
                        etr1.appendChild(etd);
                        
                    } // for loop ends here
                    
                    tbody.appendChild(etr1);
                    
                    // Create out time row
                    
                    etr2=document.createElement("tr");
                    var etd=document.createElement("td");
                    etd.innerHTML="Out";
                    etd.setAttribute("class",`text-left out_td`);
                    etd.style.backgroundColor = '#ffffff';
                    etr2.appendChild(etd);
                    
                    for (var i=1; i<=totdays;i++){
                        
                        etd=document.createElement("td");
                        etd.setAttribute("id",`out${j}d${i}`);
                        etd.setAttribute("class",`text-center`);
                        etd.innerHTML="";
                        etr2.appendChild(etd);
                        
                    } // for loop ends here
                    
                    tbody.appendChild(etr2);
                
                    // Create duration row
                    
                    etr3=document.createElement("tr");
                    var etd=document.createElement("td");
                    etd.innerHTML="Duration";
                    etd.setAttribute("class",`text-center dur_td`);
                    etd.style.backgroundColor = '#ffffff';
                    etr3.appendChild(etd);
                    
                    for (var i=1; i<=totdays;i++){
                        
                        etd=document.createElement("td");
                        etd.setAttribute("id",`dur${j}d${i}`);
                        etd.setAttribute("class",`text-center`);
                        etd.innerHTML="";
                        etr3.appendChild(etd);
                        
                    } // for loop ends here
                    
                    tbody.appendChild(etr3);
                    
                    // Total Days
                     
                    var etd=document.createElement("td");
                    
                    for (var p=0;p<res.message.attendance_one.length;p++){
                    
                        var citem=res.message.attendance_one[p];
                        
                        if(js.data[j].employee==citem.Employee){
                            
                            etd.innerHTML=citem.No_of_Present_Days;
                             
                        } // if ends here
                        
                    } // for loop ends here
                    
                    // etd.innerHTML=js.data[j].employee;
                    etd.setAttribute('rowSpan', '3');
                    etd.setAttribute('class', 'text-center align-middle');
                    etr1.appendChild(etd);
                    
                    // Total Hour
                    
                    var etd=document.createElement("td");
                    
                    for (var s=0;s<res.message.attendance_two.length;s++){
                                
                        var ditem=res.message.attendance_two[s];
                        
                        if(js.data[j].employee==ditem.Employee){
                            
                            etd.innerHTML=ditem.Actual_no_of_Hours;
                             
                        } // if ends here
                        
                    } // for loop ends here
                    
                    // etd.innerHTML=js.data[j].employee_name;
                    etd.setAttribute('rowSpan', '3');
                    etd.setAttribute('class', 'text-center align-middle');
                    etr1.appendChild(etd);
                
                    mtable.appendChild(tbody);
                    mtablediv.appendChild(mtable);   
                    
                }//end for j loop over employee
                
                for (j=0;j<js.data.length;j++){
                   
                //   var doj=moment(js.data[j].date_of_joining,"YYYY-MM-DD");
                    //  console.log(moment(doj).format("DD//MM/YYYY"))
                    var countp=0;var countlwp=0;var counta=0;
                    
                    // Holiday
                    
                    for ( m=0;m<res.message.holidays.length;m++){
                                
                        var d1=moment(res.message.holidays[m].holiday_date,"YYYY-MM-DD");
                        var hday=d1.date();
                        var el21=document.getElementById(`in${j}d${hday}`);
                        
                        if (el21!=" "){
                            
                            el21.innerHTML="00:00";
                            
                        } // if ends here
                        
                        var el22=document.getElementById(`out${j}d${hday}`);
                        
                        if (el22!=" "){
                            
                            el22.innerHTML="00:00";
                            
                        } // if ends here
                        
                        var el23=document.getElementById(`dur${j}d${hday}`);
                        
                        if (el23!=" "){
                            
                            el23.innerHTML="00:00";
                            
                        } // if ends here
                        
                    } // end for m here
                    
                    // This loop is used for placing employee attendance record
                    
                    for (var l=0;l<res.message.attendance.length;l++){
                        
                        wday=moment(res.message.attendance[l].WorkDate,"YYYY-MM-DD");
                        day=wday.date();
                        
                        if (js.data[j].employee==res.message.attendance[l].Employee){
                            
                            var elin=document.getElementById(`in${j}d${day}`);
                            var elout=document.getElementById(`out${j}d${day}`);
                            // var ellate=document.getElementById(`late${j}${day}`);
                            // var elearly=document.getElementById(`early${j}${day}`);
                            var eldur=document.getElementById(`dur${j}d${day}`);
                            // var elstatus=document.getElementById(`status${j}${day}`);
                            
                            if(res.message.attendance[l].LateIn !=" "){
                            
                                elin.innerHTML= moment(res.message.attendance[l].FirstIn,"HH:mm:ss").format("HH:mm");
                                elin.setAttribute("class",`text-center text-danger p-2`);
                        
                            } // if ends here
                            
                            else{
                                
                                elin.innerHTML= moment(res.message.attendance[l].FirstIn,"HH:mm:ss").format("HH:mm");
                                
                            } // else ends here
                        
                            if(res.message.attendance[l].EarlyOut !=" "){
                            
                                if(res.message.attendance[l].LastOut=="Missed"){
                                    
                                    // elout.innerHTML= res.message.attendance[l].LastOut;
                                    elout.innerHTML= "00:00";
                                    // elout.setAttribute("class",`text-center text-warning p-2`);
                                    
                                } // if ends here
                                
                                else if(res.message.attendance[l].LastOut== " "){
                                    
                                    elout.innerHTML= "00:00";
                                    // elout.setAttribute("class",`text-center text-warning p-2`);
                                    
                                } // else if ends here
                                
                                else{
                                    
                                    elout.innerHTML= moment(res.message.attendance[l].LastOut,"HH:mm:ss").format("HH:mm");
                                    elout.setAttribute("class",`text-center text-warning p-2`);
                                    
                                } // else ends here
                                
                            } // if ends here
                            
                            else{
                                
                                if(res.message.attendance[l].LastOut=="Missed"){
                                    
                                    // elout.innerHTML= res.message.attendance[l].LastOut;
                                    elout.innerHTML= "00:00";
                                    // elout.setAttribute("class",`text-center text-warning p-2`);
                                    
                                } // if ends here
                                
                                else if(res.message.attendance[l].LastOut == " "){
                                    
                                    elout.innerHTML= "00:00";
                                    
                                } // else if ends here
                                
                                else {
                                    
                                    elout.innerHTML= moment(res.message.attendance[l].LastOut,"HH:mm:ss").format("HH:mm");
                                    
                                } // else ends here
                                
                            } // else ends here
                        
                            if (res.message.attendance[l].duration !=" ") {
                                
                                eldur.innerHTML= moment(res.message.attendance[l].duration,"HH:mm:ss").format("HH:mm"); 
                                
                            } // if ends here
                        
                            else {
                            
                                eldur.innerHTML= "00:00";
                                
                            } // else ends here 
                            
                        // elout.innerHTML= res.message.attendance[l].LastOut;
                        // ellate.innerHTML= res.message.attendance[l].LateIn;
                        // elearly.innerHTML= res.message.attendance[l].EarlyOut;
                        // eldur.innerHTML= res.message.attendance[l].duration;
                        // elstatus.innerHTML= res.message.attendance[l].Status;
                        }//end if
                    }//end for l 

                    // For remaining  field filled with A
                    
                    for (var k=1; k<=totdays;k++){
                                
                        // var el3=document.getElementById(`status${j}${k}`);
                        var el31=document.getElementById(`in${j}d${k}`);
                        var el32=document.getElementById(`out${j}d${k}`);
                        var el33=document.getElementById(`dur${j}d${k}`);
                        // var d2=date.format("YYYY-")+ date.month() + `-${k}`;
                        
                        // if (el31.innerHTML=="" || el32.innerHTML==""  || el33.innerHTML=="" ){
                            
                        //     if((moment(d2,"YYYY-MM-DD").diff(doj))>=0){
                                
                        //         if(moment().diff(moment(d2,"YYYY-MM-DD"))>0) {
                                    
                        //             // el3.innerHTML="A";  
                        //             el31.innerHTML="00:00";
                        //             el32.innerHTML="00:00";
                        //             el33.innerHTML="00:00";
                                    
                        //         } // if ends here
                        //     } // if ends here
                        // } // if ends here
                        
                        
                        if (el31.innerHTML==""){
                            
                            el31.innerHTML="00:00";
                            
                        } // if ends here
                        
                        if(el32.innerHTML==""){
                            
                            el32.innerHTML="00:00";
                            
                        } // if ends here
                        
                        if(el33.innerHTML==""){
                            
                            el33.innerHTML="00:00";
                            
                        } // if ends here
    
                    } // end for k loop
                } //end of j
            }); //end of fetch employee
            } //end for callback res
        }); // frappe.call ends here
    } // function ends here
    
    //  Show Employee wise Report
    
    function showEmployeeWise_one(empwise){
        
        empWiseBlank_one = empwise
        var firstDayOfRecentMonth_one = moment().startOf('month').format('YYYY-MM-DD');
        
        var selectBox_new = document.getElementById("monthlyattendance_one");
        var selectedValue_new = selectBox_new.options[selectBox_new.selectedIndex].value;
        
        // Display of data for any employee with no month selected
            
        if (empWiseBlank_one != 'All' && selectedValue_new.length === 0){

            showMonthlyAttendanceWithEmployeeFilter_one(firstDayOfRecentMonth_one,empWiseBlank_one)
            
        } // if ends here
        
        // Display of data for all employees with no month selected
        
        else if(empWiseBlank_one === 'All' && selectedValue_new.length === 0){
            
            showMonthlyAttendance_one(firstDayOfRecentMonth_one)
            
        } // else if ends here
        
        // Display of data for any employee with any month selected
            
        else if (empWiseBlank_one != 'All' && selectedValue_new.length > 0){
            
            showMonthlyAttendanceWithEmployeeFilter_one(selectedValue_new,empWiseBlank_one)
            
        } // else if ends here
        
        // Display of data for All employees with any month selected
            
        else if (empWiseBlank_one === 'All' && selectedValue_new.length > 0){
            
            showMonthlyAttendance_one(selectedValue_new);
            
        } // else if ends here
        
    } // function ends here

    // Show Month wise Report
    
    function ShowDataEmployeeWiswAndMonthlyWise_one(month) {
        
        var selectBox_new_one = document.getElementById("searchEmployee_one");
        var selectedValue_new_one = selectBox_new_one.options[selectBox_new_one.selectedIndex].value;
        month_new_one = month;
        var firstDayOfRecentMonth_new_one = moment().startOf('month').format('YYYY-MM-DD');
    
        // Display of data for All employees with any month selected
            
        if (selectedValue_new_one.length === 0 && month_new_one.length > 0){
            
            showMonthlyAttendance_one(month_new_one)
            
        } // if ends here
      
        // Display of data for any employee with any month selected
            
        else if (selectedValue_new_one != 'All' && month_new_one.length > 0){
            
            showMonthlyAttendanceWithEmployeeFilter_one(month_new_one,selectedValue_new_one);
            
        } // else if ends here
        
        // Display of data for All employees with any month selected
            
        else if (selectedValue_new_one === 'All' && month_new_one.length > 0){
            
            showMonthlyAttendance_one(month_new_one)
            
        } // else if ends here
        
    } // function ends here   
    
    // Switiching between downloading options

    function changeFunc_two() {
        
        var selectBox = document.getElementById("selectBox_two");
        var selectedValue = selectBox.options[selectBox.selectedIndex].value;
        
        if(selectedValue=="exportToExcel_DPR"){
            
          exportToExcel_DPR(); // calling the funtion to download the report in excel format
          
        } // else ends here
        
        else if(selectedValue=="exportToCSV_DPR"){
            
            exportToCSV_DPR(); // calling the funtion to download the report in csv format
            
        } // else ends here
        
        else if(selectedValue=="exportToPDF_DPR"){
            
            exportToPDF_DPR(); // calling the funtion to download the report in pdf format
            
        } // else ends here
        
    } // function ends here
    
    //  Download Daily Production Report in Excel
    
    function exportToExcel_DPR() {
        
        var table = document.getElementById("monthly_attendance_one_table");
        var rowCount = table.rows.length;
        var clonedTable = table.cloneNode(true);
        
        // Loop through the cloned table to format date cells
        
        for (var i = 1; i < clonedTable.rows.length; i++) {
            
            var dateCell = clonedTable.rows[i].cells[0];
            var dateString = dateCell.textContent;
            var formattedDate = formatDate(dateString);
            dateCell.textContent = formattedDate;
            
        } // for loop ends here
        
        var workbook = XLSX.utils.table_to_book(clonedTable, { sheet: "Sheet 1" });
        var excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' });
        
        saveAsExcel(excelBuffer, "daily_production_report.xlsx");
        
    } // function ends here
    
    function saveAsExcel(buffer, filename) {
        
        var blob = new Blob([buffer], { type: 'application/octet-stream' });
        var url = window.URL.createObjectURL(blob);
        var link = document.createElement('a');
        link.href = url;
        link.setAttribute('download', filename);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
    } // function ends here
        
    function formatDate(dateString) {
        
        var parts = dateString.split('/');
        
        if (parts.length === 3) {
            
            var day = parts[0];
            var month = parts[1];
            var year = parts[2];
            
            // Construct a new date string in "MM/DD/YYYY" format
            
            var formattedDate = month + '/' + day + '/' + year;
            return formattedDate;
            
        } // if ends here
        
        else {
            
        // Return the original date string if the input format is not as expected
        
        return dateString;
        
        } // else ends here
        
    } // function ends here
    
    //  Download Daily Production Report in CSV

    // function exportToCSV_DPR() {
        
    //     // Get the table data
        
    //     var tableOne = document.querySelector('table[id="monthly_attendance_one_table"]');
        
    //     // console.log(document.querySelectorAll('table')[0]);
        
    //     const rows = tableOne.querySelectorAll('tr');

    //     // Build the CSV data
        
    //     let csv = '';
        
    //     for (let i = 0; i < rows.length; i++) {
            
    //         var cells = rows[i].querySelectorAll('td');
            
    //         if (cells.length===0){
                
    //             cells = rows[i].querySelectorAll('th');
                
    //         } // if ends here
        
    //       let row = '';
          
    //         if (rows[i].style.display!="none"){
              
    //             for (let j = 0; j < cells.length; j++) {
                  
    //                 row += cells[j].textContent.replaceAll(",","|") + ',';
                
    //             } // for loop ends here
            
    //         csv += row + '\r\n';
          
    //         } // if ends here
          
    //     } // for loop ends here

    //     // Download the CSV file
        
    //     const link = document.createElement('a');
    //     link.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv));
    //     link.setAttribute('download', 'daily_production_report.csv');
    //     link.click();
        
    // } // function ends here
    
    // Download Daily Production Report in PDF
    
    function exportToPDF_DPR(){
        
        var month_value = document.getElementById('monthlyattendance_one').value
        
        var current_month_val = moment().format('MMMM YYYY');
        
        // Check if the month is current month or not
        
        if(month_value == 0){
            
            month_value = current_month_val;
            
        } else {
            
            month_value = moment(month_value).format("MMMM YYYY");
    
        } // else ends here
         
        $.getScript("https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js",()=>{ // calling the cdn for jsPDF
        $.getScript("https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.6/jspdf.plugin.autotable.min.js",()=>{ // calling the cdn for autotable
        
        var doc = new jsPDF('L', 'pt', 'legal');  
        var htmlstring = '';  
        var tempVarToCheckPageHeight = 0;  
        var pageHeight = 0;  
        pageHeight = doc.internal.pageSize.height; 
        pageHeight = 2000; 
        
        specialElementHandlers = {  
            
            '#bypassme': function(element, renderer) {  
        
                return true  
                
            } // function ends here
            
        }; // Special Element Handler ends here
        
        margins = {  
            
            top: 150,
            width: 1000 
            
        };  // Margin ends here
        
        var y = 20;  var x= 1800;
        doc.setLineWidth(0.5);
        
        // Addition the first page heading
        
        doc.setFontSize(14);
        doc.text(360, y = y + 20, "Daily Production Report for " + month_value);

        // Addition the second page heading
        
        doc.setFontSize(12);
        doc.text(435, y = y + 20, "Company : GewinnsHR");
        
        doc.autoTable({  
            
            html: '#monthly_attendance_one_table',
            startY: 70,
            theme: 'plain',
            fontSize: 6,

            didParseCell: function (data) {
                
                data.cell.styles.lineColor = [0, 0, 0];  // Set border color
                data.cell.styles.lineWidth = 0.1;        // Set the border width
                
                var row = data.row.index;
                var column = data.column.index;
            
            }, // didParseCell ends here
            
            columnStyles: {
            
                0: { cellWidth: 46 },
                1: { cellWidth: 40 },
                2: { cellWidth: 35 },3: { cellWidth: 25 },4: { cellWidth: 25 },5: { cellWidth: 25 },6: { cellWidth: 25 },7: { cellWidth: 25 },8: { cellWidth: 25 },
                9: { cellWidth: 25 },10: { cellWidth: 25 },11: { cellWidth: 25 },12: { cellWidth: 25 },13: { cellWidth: 25 },14: { cellWidth: 25 },
                15: { cellWidth: 25 },16: { cellWidth: 25 },17: { cellWidth: 25 },18: { cellWidth: 25 },19: { cellWidth: 25 },20: { cellWidth: 25 },
                21: { cellWidth: 25 },22: { cellWidth: 25 },23: { cellWidth: 25 },24: { cellWidth: 25 },25: { cellWidth: 25 },26: { cellWidth: 25 },
                27: { cellWidth: 25 },28: { cellWidth: 25 },29: { cellWidth: 25 },30: { cellWidth: 25 },31: { cellWidth: 25 },32: { cellWidth: 25 },
                33: { cellWidth: 25 },34: { cellWidth: 25 },35: { cellWidth: 25 },36: { cellWidth: 25 },37: { cellWidth: 25 },38: { cellWidth: 25 },
                
            }, // column style ends here
                
            styles: {  
                
                minCellHeight: 10,  // set the minimum cell height
            
            },  // styles end here
            
        })  // doc.autotable ends here
        
        // Add a footer to each page
        
        var pageCount = doc.internal.getNumberOfPages();
        
        var currentD = moment().format("DD/MM/YYYY hh:mm:ss a")
        
        for (var i = 1; i <= pageCount; i++) {
            
            doc.setPage(i);
            
            var footerText = "Report Generated on : " + currentD;
            
            // var textX = 30;                                       // left Aligned
            // var textY = doc.internal.pageSize.getHeight() - 35;   // 35 pixels from the bottom
        
            var textWidth = doc.getStringUnitWidth(footerText) * doc.internal.getFontSize();
        
            var textX = doc.internal.pageSize.getWidth() - textWidth - 20; // Aligned to the right margin with a 20-pixel padding
        
            var textY = doc.internal.pageSize.getHeight() - 35; // 35 pixels from the bottom
        
            doc.setFontSize(10);
        
            doc.text(footerText, textX, textY);
            
        } // for loop ends here
        
        // Add outline border to the entire document
        
            var pageCount = doc.internal.getNumberOfPages();
            
            for (var i = 0; i < pageCount; i++) {
                
                doc.setPage(i);
                
                doc.rect(20, 20, doc.internal.pageSize.getWidth() - 40, doc.internal.pageSize.getHeight() - 40, 'S');
                
            } // for loop ends here

        doc.save('daily_production_report.pdf'); // Save the report in pdf format
    
        }); // end of jspdf.min.js
        }); // jspdf.plugin.autotable.min.js
        
    } // function ends here
    
